(function(q,x){typeof exports=="object"&&typeof module<"u"?x(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],x):(q=typeof globalThis<"u"?globalThis:q||self,x(q.instantReact={},q.React))})(this,function(q,x){"use strict";let Ne=!1;typeof window<"u"&&typeof window.localStorage<"u"&&(Ne=!!window.localStorage.getItem("devBackend")||!!window.localStorage.getItem("__instantLogging"));const z={info:Ne?console.info.bind(console):()=>{},debug:Ne?console.debug.bind(console):()=>{},error:Ne?console.error.bind(console):()=>{}};function Y(t){if(typeof t=="number")return(Math.abs(t*2654435761)>>>0).toString(16);if(typeof t=="boolean")return t?"1":"0";if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string"){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24),e=e>>>0;return e.toString(16)}if(Array.isArray(t)){let e=2166136261;for(let n=0;n<t.length;n++){e^=(n+1)*2654435761;const r=Y(t[n]);for(let i=0;i<r.length;i++)e^=r.charCodeAt(i),e*=16777619,e=e>>>0}return e.toString(16)}if(typeof t=="object"){let e=2166136261;const n=Object.keys(t).sort();for(let r=0;r<n.length;r++){const i=n[r],s=Y(i);e^=parseInt(s,16),e*=16777619,e=e>>>0;const o=Y(t[i]);e^=parseInt(o,16),e*=16777619,e=e>>>0}return e.toString(16)}return Y(String(t))}const M={Remove:"remove",Replace:"replace",Add:"add"},tn=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),yr=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),Fe=Symbol.iterator,H={mutable:"mutable",immutable:"immutable"},ft={};function G(t){var e;return(e=t.copy)!==null&&e!==void 0?e:t.original}function _e(t){return!!R(t)}function R(t){return typeof t!="object"?null:t==null?void 0:t[tn]}function ht(t){var e;const n=R(t);return n?(e=n.copy)!==null&&e!==void 0?e:n.original:t}function se(t,e){if(!t||typeof t!="object")return!1;let n;return Object.getPrototypeOf(t)===Object.prototype||Array.isArray(t)||t instanceof Map||t instanceof Set||!!(e!=null&&e.mark)&&((n=e.mark(t,H))===H.immutable||typeof n=="function")}function nn(t,e=[]){if(Object.hasOwnProperty.call(t,"key")){const n=R(fe(t.parent.copy,t.key));if(n!==null&&(n==null?void 0:n.original)!==t.original)return null;e.push(t.parent.type===3?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key)}if(t.parent)return nn(t.parent,e);e.reverse();try{br(t.copy,e)}catch{return null}return e}function ye(t){return Array.isArray(t)?1:t instanceof Map?2:t instanceof Set?3:0}function fe(t,e){return ye(t)===2?t.get(e):t[e]}function Pe(t,e,n){ye(t)===2?t.set(e,n):t[e]=n}function pt(t,e){const n=R(t);return(n?G(n):t)[e]}function he(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function vt(t){if(t)for(;t.finalities.revoke.length>0;)t.finalities.revoke.pop()()}function be(t,e){return e?t:[""].concat(t).map(n=>{const r=`${n}`;return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}function br(t,e){for(let n=0;n<e.length-1;n+=1){const r=e[n];if(t=fe(ye(t)===3?Array.from(t):t,r),typeof t!="object")throw new Error(`Cannot resolve patch at '${e.join("/")}'.`)}return t}function gr(t){const e=Object.create(Object.getPrototypeOf(t));return Reflect.ownKeys(t).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(t,n);if(r.enumerable&&r.configurable&&r.writable){e[n]=t[n];return}r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:t[n]}),Reflect.defineProperty(e,n,r)}),e}const wr=Object.prototype.propertyIsEnumerable;function rn(t,e){let n;if(Array.isArray(t))return Array.prototype.concat.call(t);if(t instanceof Set)return new Set(t.values());if(t instanceof Map)return new Map(t);if(e!=null&&e.mark&&(n=e.mark(t,H),n!==void 0)&&n!==H.mutable){if(n===H.immutable)return gr(t);if(typeof n=="function"){if(e.enablePatches||e.enableAutoFreeze)throw new Error("You can't use mark and patches or auto freeze together.");return n()}throw new Error(`Unsupported mark result: ${n}`)}else if(typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype){const r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),Object.getOwnPropertySymbols(t).forEach(i=>{wr.call(t,i)&&(r[i]=t[i])}),r}else throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function W(t){t.copy||(t.copy=rn(t.original,t.options))}function Te(t){if(!se(t))return ht(t);if(Array.isArray(t))return t.map(Te);if(t instanceof Map)return new Map(Array.from(t.entries()).map(([n,r])=>[n,Te(r)]));if(t instanceof Set)return new Set(Array.from(t).map(Te));const e=Object.create(Object.getPrototypeOf(t));for(const n in t)e[n]=Te(t[n]);return e}function qe(t){return _e(t)?Te(t):t}function ae(t){var e;t.assignedMap=(e=t.assignedMap)!==null&&e!==void 0?e:new Map,t.operated||(t.operated=!0,t.parent&&ae(t.parent))}function sn(){throw new Error("Cannot modify frozen object")}function Oe(t,e,n,r,i){{n=n??new WeakMap,r=r??[],i=i??[];const o=n.has(t)?n.get(t):t;if(r.length>0){const a=r.indexOf(o);if(o&&typeof o=="object"&&a!==-1)throw r[0]===o?new Error("Forbids circular reference"):new Error(`Forbids circular reference: ~/${i.slice(0,a).map((u,c)=>{if(typeof u=="symbol")return`[${u.toString()}]`;const l=r[c];return typeof u=="object"&&(l instanceof Map||l instanceof Set)?Array.from(l.keys()).indexOf(u):u}).join("/")}`);r.push(o),i.push(e)}else r.push(o)}if(Object.isFrozen(t)||_e(t)){r.pop(),i.pop();return}switch(ye(t)){case 2:for(const[a,u]of t)Oe(a,a,n,r,i),Oe(u,a,n,r,i);t.set=t.clear=t.delete=sn;break;case 3:for(const a of t)Oe(a,a,n,r,i);t.add=t.clear=t.delete=sn;break;case 1:Object.freeze(t);let o=0;for(const a of t)Oe(a,o,n,r,i),o+=1;break;default:Object.freeze(t),Object.keys(t).forEach(a=>{const u=t[a];Oe(u,a,n,r,i)})}r.pop(),i.pop()}function ze(t,e){return t instanceof Map?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function on(t,e){if(e in t){let n=Reflect.getPrototypeOf(t);for(;n;){const r=Reflect.getOwnPropertyDescriptor(n,e);if(r)return r;n=Reflect.getPrototypeOf(n)}}}function _t(t,e){const n=ye(t);if(n===0)Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)});else if(n===1){let r=0;for(const i of t)e(r,i,t),r+=1}else t.forEach((r,i)=>e(i,r,t))}function an(t,e,n){if(_e(t)||!se(t,n)||e.has(t)||Object.isFrozen(t))return;const r=t instanceof Set,i=r?new Map:void 0;if(e.add(t),_t(t,(s,o)=>{var a;if(_e(o)){const u=R(o);W(u);const c=!((a=u.assignedMap)===null||a===void 0)&&a.size||u.operated?u.copy:u.original;Pe(r?i:t,s,c)}else an(o,e,n)}),i){const s=t,o=Array.from(s);s.clear(),o.forEach(a=>{s.add(i.has(a)?i.get(a):a)})}}function mr(t,e){const n=t.type===3?t.setMap:t.copy;t.finalities.revoke.length>1&&t.assignedMap.get(e)&&n&&an(fe(n,e),t.finalities.handledSet,t.options)}function yt(t){t.type===3&&t.copy&&(t.copy.clear(),t.setMap.forEach(e=>{t.copy.add(ht(e))}))}function bt(t,e,n,r){if(t.operated&&t.assignedMap&&t.assignedMap.size>0&&!t.finalized){if(n&&r){const s=nn(t);s&&e(t,s,n,r)}t.finalized=!0}}function gt(t,e,n,r){const i=R(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((s,o)=>{var a;const u=t.type===3?t.setMap:t.copy;if(he(fe(u,e),n)){let c=i.original;i.copy&&(c=i.copy),yt(t),bt(t,r,s,o),t.options.enableAutoFreeze&&(t.options.updatedValues=(a=t.options.updatedValues)!==null&&a!==void 0?a:new WeakMap,t.options.updatedValues.set(c,i.original)),Pe(u,e,c)}}),t.options.enableAutoFreeze&&i.finalities!==t.finalities&&(t.options.enableAutoFreeze=!1)),se(n,t.options)&&t.finalities.draft.push(()=>{const s=t.type===3?t.setMap:t.copy;he(fe(s,e),n)&&mr(t,e)})}function Or(t,e,n,r,i){let{original:s,assignedMap:o,options:a}=t,u=t.copy;u.length<s.length&&([s,u]=[u,s],[n,r]=[r,n]);for(let c=0;c<s.length;c+=1)if(o.get(c.toString())&&u[c]!==s[c]){const l=e.concat([c]),f=be(l,i);n.push({op:M.Replace,path:f,value:qe(u[c])}),r.push({op:M.Replace,path:f,value:qe(s[c])})}for(let c=s.length;c<u.length;c+=1){const l=e.concat([c]),f=be(l,i);n.push({op:M.Add,path:f,value:qe(u[c])})}if(s.length<u.length){const{arrayLengthAssignment:c=!0}=a.enablePatches;if(c){const l=e.concat(["length"]),f=be(l,i);r.push({op:M.Replace,path:f,value:s.length})}else for(let l=u.length;s.length<l;l-=1){const f=e.concat([l-1]),h=be(f,i);r.push({op:M.Remove,path:h})}}}function Sr({original:t,copy:e,assignedMap:n},r,i,s,o){n.forEach((a,u)=>{const c=fe(t,u),l=qe(fe(e,u)),f=a?ze(t,u)?M.Replace:M.Add:M.Remove;if(he(c,l)&&f===M.Replace)return;const h=r.concat(u),v=be(h,o);i.push(f===M.Remove?{op:f,path:v}:{op:f,path:v,value:l}),s.push(f===M.Add?{op:M.Remove,path:v}:f===M.Remove?{op:M.Add,path:v,value:c}:{op:M.Replace,path:v,value:c})})}function Er({original:t,copy:e},n,r,i,s){let o=0;t.forEach(a=>{if(!e.has(a)){const u=n.concat([o]),c=be(u,s);r.push({op:M.Remove,path:c,value:a}),i.unshift({op:M.Add,path:c,value:a})}o+=1}),o=0,e.forEach(a=>{if(!t.has(a)){const u=n.concat([o]),c=be(u,s);r.push({op:M.Add,path:c,value:a}),i.unshift({op:M.Remove,path:c,value:a})}o+=1})}function Ae(t,e,n,r){const{pathAsArray:i=!0}=t.options.enablePatches;switch(t.type){case 0:case 2:return Sr(t,e,n,r,i);case 1:return Or(t,e,n,r,i);case 3:return Er(t,e,n,r,i)}}let Rr=!1;const We=(t,e,n=!1)=>{if(typeof t=="object"&&t!==null&&(!se(t,e)||n)&&!Rr)throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},wt={get size(){return G(R(this)).size},has(t){return G(R(this)).has(t)},set(t,e){const n=R(this),r=G(n);return(!r.has(t)||!he(r.get(t),e))&&(W(n),ae(n),n.assignedMap.set(t,!0),n.copy.set(t,e),gt(n,t,e,Ae)),this},delete(t){if(!this.has(t))return!1;const e=R(this);return W(e),ae(e),e.original.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.copy.delete(t),!0},clear(){const t=R(this);if(this.size){W(t),ae(t),t.assignedMap=new Map;for(const[e]of t.original)t.assignedMap.set(e,!1);t.copy.clear()}},forEach(t,e){const n=R(this);G(n).forEach((r,i)=>{t.call(e,this.get(i),i,this)})},get(t){var e,n;const r=R(this),i=G(r).get(t),s=((n=(e=r.options).mark)===null||n===void 0?void 0:n.call(e,i,H))===H.mutable;if(r.options.strict&&We(i,r.options,s),s||r.finalized||!se(i,r.options)||i!==r.original.get(t))return i;const o=ft.createDraft({original:i,parentDraft:r,key:t,finalities:r.finalities,options:r.options});return W(r),r.copy.set(t,o),o},keys(){return G(R(this)).keys()},values(){const t=this.keys();return{[Fe]:()=>this.values(),next:()=>{const e=t.next();return e.done?e:{done:!1,value:this.get(e.value)}}}},entries(){const t=this.keys();return{[Fe]:()=>this.entries(),next:()=>{const e=t.next();if(e.done)return e;const n=this.get(e.value);return{done:!1,value:[e.value,n]}}}},[Fe](){return this.entries()}},jr=Reflect.ownKeys(wt),un=(t,e,{isValuesIterator:n})=>()=>{var r,i;const s=e.next();if(s.done)return s;const o=s.value;let a=t.setMap.get(o);const u=R(a),c=((i=(r=t.options).mark)===null||i===void 0?void 0:i.call(r,a,H))===H.mutable;if(t.options.strict&&We(o,t.options,c),!c&&!u&&se(o,t.options)&&!t.finalized&&t.original.has(o)){const l=ft.createDraft({original:o,parentDraft:t,key:o,finalities:t.finalities,options:t.options});t.setMap.set(o,l),a=l}else u&&(a=u.proxy);return{done:!1,value:n?a:[a,a]}},mt={get size(){return R(this).setMap.size},has(t){const e=R(this);if(e.setMap.has(t))return!0;W(e);const n=R(t);return!!(n&&e.setMap.has(n.original))},add(t){const e=R(this);return this.has(t)||(W(e),ae(e),e.assignedMap.set(t,!0),e.setMap.set(t,t),gt(e,t,t,Ae)),this},delete(t){if(!this.has(t))return!1;const e=R(this);W(e),ae(e);const n=R(t);return n&&e.setMap.has(n.original)?(e.assignedMap.set(n.original,!1),e.setMap.delete(n.original)):(!n&&e.setMap.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.setMap.delete(t))},clear(){if(!this.size)return;const t=R(this);W(t),ae(t);for(const e of t.original)t.assignedMap.set(e,!1);t.setMap.clear()},values(){const t=R(this);W(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:un(t,e,{isValuesIterator:!0})}},entries(){const t=R(this);W(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:un(t,e,{isValuesIterator:!1})}},keys(){return this.values()},[Fe](){return this.values()},forEach(t,e){const n=this.values();let r=n.next();for(;!r.done;)t.call(e,r.value,r.value,this),r=n.next()}},Cr=Reflect.ownKeys(mt),cn=new WeakSet,ln={get(t,e,n){var r,i;const s=(r=t.copy)===null||r===void 0?void 0:r[e];if(s&&cn.has(s))return s;if(e===tn)return t;let o;if(t.options.mark){const c=e==="size"&&(t.original instanceof Map||t.original instanceof Set)?Reflect.get(t.original,e):Reflect.get(t.original,e,n);if(o=t.options.mark(c,H),o===H.mutable)return t.options.strict&&We(c,t.options,!0),c}const a=G(t);if(a instanceof Map&&jr.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(wt,"size").get.call(t.proxy);const c=wt[e];if(c)return c.bind(t.proxy)}if(a instanceof Set&&Cr.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(mt,"size").get.call(t.proxy);const c=mt[e];if(c)return c.bind(t.proxy)}if(!ze(a,e)){const c=on(a,e);return c?"value"in c?c.value:(i=c.get)===null||i===void 0?void 0:i.call(t.proxy):void 0}const u=a[e];if(t.options.strict&&We(u,t.options),t.finalized||!se(u,t.options))return u;if(u===pt(t.original,e)){if(W(t),t.copy[e]=Ot({original:t.original[e],parentDraft:t,key:t.type===1?Number(e):e,finalities:t.finalities,options:t.options}),typeof o=="function"){const c=R(t.copy[e]);return W(c),ae(c),c.copy}return t.copy[e]}return u},set(t,e,n){var r;if(t.type===3||t.type===2)throw new Error("Map/Set draft does not support any property assignment.");let i;if(t.type===1&&e!=="length"&&!(Number.isInteger(i=Number(e))&&i>=0&&(e===0||i===0||String(i)===String(e))))throw new Error("Only supports setting array indices and the 'length' property.");const s=on(G(t),e);if(s!=null&&s.set)return s.set.call(t.proxy,n),!0;const o=pt(G(t),e),a=R(o);return a&&he(a.original,n)?(t.copy[e]=n,t.assignedMap=(r=t.assignedMap)!==null&&r!==void 0?r:new Map,t.assignedMap.set(e,!1),!0):(he(n,o)&&(n!==void 0||ze(t.original,e))||(W(t),ae(t),ze(t.original,e)&&he(n,t.original[e])?t.assignedMap.delete(e):t.assignedMap.set(e,!0),t.copy[e]=n,gt(t,e,n,Ae)),!0)},has(t,e){return e in G(t)},ownKeys(t){return Reflect.ownKeys(G(t))},getOwnPropertyDescriptor(t,e){const n=G(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},getPrototypeOf(t){return Reflect.getPrototypeOf(t.original)},setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(t,e){var n;return t.type===1?ln.set.call(this,t,e,void 0,t.proxy):(pt(t.original,e)!==void 0||e in t.original?(W(t),ae(t),t.assignedMap.set(e,!1)):(t.assignedMap=(n=t.assignedMap)!==null&&n!==void 0?n:new Map,t.assignedMap.delete(e)),t.copy&&delete t.copy[e],!0)}};function Ot(t){const{original:e,parentDraft:n,key:r,finalities:i,options:s}=t,o=ye(e),a={type:o,finalized:!1,parent:n,original:e,copy:null,proxy:null,finalities:i,options:s,setMap:o===3?new Map(e.entries()):void 0};(r||"key"in t)&&(a.key=r);const{proxy:u,revoke:c}=Proxy.revocable(o===1?Object.assign([],a):a,ln);if(i.revoke.push(c),cn.add(u),a.proxy=u,n){const l=n;l.finalities.draft.push((f,h)=>{var v,b;const m=R(u);let E=l.type===3?l.setMap:l.copy;const S=fe(E,r),y=R(S);if(y){let g=y.original;y.operated&&(g=ht(S)),yt(y),bt(y,Ae,f,h),l.options.enableAutoFreeze&&(l.options.updatedValues=(v=l.options.updatedValues)!==null&&v!==void 0?v:new WeakMap,l.options.updatedValues.set(g,y.original)),Pe(E,r,g)}(b=m.callbacks)===null||b===void 0||b.forEach(g=>{g(f,h)})})}else{const l=R(u);l.finalities.draft.push((f,h)=>{yt(l),bt(l,Ae,f,h)})}return u}ft.createDraft=Ot;function Pr(t,e,n,r,i){var s;const o=R(t),a=(s=o==null?void 0:o.original)!==null&&s!==void 0?s:t,u=!!e.length;if(o!=null&&o.operated)for(;o.finalities.draft.length>0;)o.finalities.draft.pop()(n,r);const c=u?e[0]:o?o.operated?o.copy:o.original:t;return o&&vt(o),i&&Oe(c,c,o==null?void 0:o.options.updatedValues),[c,n&&u?[{op:M.Replace,path:[],value:e[0]}]:n,r&&u?[{op:M.Replace,path:[],value:a}]:r]}function Tr(t,e){var n;const r={draft:[],revoke:[],handledSet:new WeakSet};let i,s;e.enablePatches&&(i=[],s=[]);const a=((n=e.mark)===null||n===void 0?void 0:n.call(e,t,H))===H.mutable||!se(t,e)?t:Ot({original:t,parentDraft:null,finalities:r,options:e});return[a,(u=[])=>{const[c,l,f]=Pr(a,u,i,s,e.enableAutoFreeze);return e.enablePatches?[c,l,f]:c}]}function St(t){const{rootDraft:e,value:n,useRawReturn:r=!1,isRoot:i=!0}=t;_t(n,(s,o,a)=>{const u=R(o);if(u&&e&&u.finalities===e.finalities){t.isContainDraft=!0;const c=u.original;if(a instanceof Set){const l=Array.from(a);a.clear(),l.forEach(f=>a.add(s===f?c:f))}else Pe(a,s,c)}else typeof o=="object"&&o!==null&&(t.value=o,t.isRoot=!1,St(t))}),i&&(t.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function dn(t){const e=R(t);if(!se(t,e==null?void 0:e.options))return t;const n=ye(t);if(e&&!e.operated)return e.original;let r;function i(){r=n===2?new Map(t):n===3?Array.from(e.setMap.values()):rn(t,e==null?void 0:e.options)}if(e){e.finalized=!0;try{i()}finally{e.finalized=!1}}else r=t;return _t(r,(s,o)=>{if(e&&he(fe(e.original,s),o))return;const a=dn(o);a!==o&&(r===t&&i(),Pe(r,s,a))}),n===3?new Set(r):r}function fn(t){if(!_e(t))throw new Error(`current() is only used for Draft, parameter: ${t}`);return dn(t)}const Ar=(t=>function e(n,r,i){var s,o,a;if(typeof n=="function"&&typeof r!="function")return function(O,...U){return e(O,Q=>n.call(this,Q,...U),r)};const u=n,c=r;let l=i;if(typeof r!="function"&&(l=r),l!==void 0&&Object.prototype.toString.call(l)!=="[object Object]")throw new Error(`Invalid options: ${l}, 'options' should be an object.`);l=Object.assign(Object.assign({},t),l);const f=_e(u)?fn(u):u,h=Array.isArray(l.mark)?(O,U)=>{for(const Q of l.mark){if(typeof Q!="function")throw new Error(`Invalid mark: ${Q}, 'mark' should be a function.`);const ce=Q(O,U);if(ce)return ce}}:l.mark,v=(s=l.enablePatches)!==null&&s!==void 0?s:!1,b=(o=l.strict)!==null&&o!==void 0?o:!1,E={enableAutoFreeze:(a=l.enableAutoFreeze)!==null&&a!==void 0?a:!1,mark:h,strict:b,enablePatches:v};if(!se(f,E)&&typeof f=="object"&&f!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");const[S,y]=Tr(f,E);if(typeof r!="function"){if(!se(f,E))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[S,y]}let g;try{g=c(S)}catch(O){throw vt(R(S)),O}const k=O=>{const U=R(S);if(!_e(O)){if(O!==void 0&&!he(O,S)&&(U!=null&&U.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");const ce=O==null?void 0:O[yr];if(ce){const De=ce[0];return E.strict&&typeof O=="object"&&O!==null&&St({rootDraft:U,value:O,useRawReturn:!0}),y([De])}if(O!==void 0)return typeof O=="object"&&O!==null&&St({rootDraft:U,value:O}),y([O])}if(O===S||O===void 0)return y([]);const Q=R(O);if(E===Q.options){if(Q.operated)throw new Error("Cannot return a modified child draft.");return y([fn(O)])}return y([O])};return g instanceof Promise?g.then(k,O=>{throw vt(R(S)),O}):k(g)})();Object.prototype.constructor.toString();function hn(t,e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&Object.keys(t).every(i=>e.hasOwnProperty(i))}function pn(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(n=>e.hasOwnProperty(n)&&t[n]===e[n])}function Ve(t,e){return typeof t!="object"||typeof e!="object"||t===null||e===null?t===e:hn(t,e)?Object.keys(t).every(n=>Ve(t[n],e[n])):!1}function vn(t,e){if(!Se(t)||!Se(e))return e;const n={};for(const r of Object.keys(t))e[r]!==null&&(n[r]=t[r]);for(const r of Object.keys(e)){if(e[r]===null)continue;const i=Se(t[r])&&Se(e[r]);n[r]=i?vn(t[r],e[r]):e[r]}return n}function _n(t,e,n){if(!Se(t))return t;const r={};for(const[i,s]of Object.entries(t))r[i]=Se(s)?_n(s,e,n):s===e?n:s;return r}function Se(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function xr(t){return t.cardinality==="one"}function Et(t){return t["value-type"]==="ref"}function yn(t){return t["value-type"]==="blob"}function Be(t,e){return t[e]}function Rt(t,e){return e.reduce((n,r)=>n&&n.get(r),t)}function oe(t,e){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.delete(e[0]);return}const[n,...r]=e;t.has(n)&&oe(t.get(n),r)}function B(t,e,n){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.set(e[0],n);return}const[r,...i]=e;let s=t.get(r);s||(s=new Map,t.set(r,s)),B(s,i,n)}function bn(t,e){const n=new Map,r=new Map,i=new Map;for(const s of e){const[o,a,u,c]=s,l=Be(t,a);if(!l){console.warn("no such attr",o,t);continue}Et(l)&&B(i,[u,a,o],s),B(n,[o,a,u],s),B(r,[a,o,u],s)}return{eav:n,aev:r,vae:i}}function gn(t){const e=new Map,n=new Map,r=new Map,i=new Map;for(const s of Object.values(t)){const o=s["forward-identity"],[a,u,c]=o,l=s["reverse-identity"];if(B(r,[u,c],s),yn(s)&&B(e,[u,c],s),s["primary?"]&&B(n,[u],s),l){const[f,h,v]=l;B(i,[h,v],s)}}return{blobAttrs:e,primaryKeys:n,forwardIdents:r,revIdents:i}}function Mr(t){return{__type:t.__type,attrs:t.attrs,triples:ee(t.eav,3),cardinalityInference:t.cardinalityInference,linkIndex:t.linkIndex}}function kr(t){return Ct(t.attrs,t.triples,t.cardinalityInference,t.linkIndex)}function jt(t){t.attrIndexes=gn(t.attrs)}function Ct(t,e,n,r){const i=bn(t,e);return i.attrs=t,i.attrIndexes=gn(t),i.cardinalityInference=n,i.linkIndex=r,i.__type="store",i}function Je(t,e){var n,r;let i;if(Array.isArray(e[0])){const[o,a]=e[0],u=t.aev.get(o);if(!u)return null;i=(n=ee(u,2).find(l=>l[2]===a))===null||n===void 0?void 0:n[0]}else i=e[0];if(!i)return null;const s=e[2];if(Array.isArray(s)&&s.length===2&&t.aev.get(s[0])){const[o,a]=s,u=t.aev.get(o);if(!u)return null;const l=(r=ee(u,2).find(m=>m[2]===a))===null||r===void 0?void 0:r[0];if(!l)return null;const[f,h,v,...b]=e;return[i,h,l,...b]}else{const[o,...a]=e;return[i,...a]}}function Ir(t,e){const n=Je(t,e);if(!n)return;const[r,i,s]=n,o=Be(t.attrs,i);o&&(oe(t.eav,[r,i,s]),oe(t.aev,[i,r,s]),Et(o)&&oe(t.vae,[s,i,r]))}let Dr=0;function wn(t,e,n){const[r,i,s]=n;let o;const a=Rt(t.ea,[r,i,s]);return a&&(o=a[3]),o||Date.now()*10+Dr++}function Ur(t,e){var n;const r=Je(t,e);if(!r)return;const[i,s,o]=r,a=Be(t.attrs,s);if(!a)return;const u=Rt(t.eav,[i,s,o]),c=(n=u==null?void 0:u[3])!==null&&n!==void 0?n:wn(t,a,r),l=[i,s,o,c];xr(a)?(B(t.eav,[i,s],new Map([[o,l]])),B(t.aev,[s,i],new Map([[o,l]]))):(B(t.eav,[i,s,o],l),B(t.aev,[s,i,o],l)),Et(a)&&B(t.vae,[o,s,i],l)}function $r(t,e){var n;const r=Je(t,e);if(!r)return;const[i,s,o]=r,a=Be(t.attrs,s);if(!a)return;if(!yn(a))throw new Error("merge operation is not supported for links");const u=Rt(t.eav,[i,s]);if(!u)return;const c=(n=u.values().next())===null||n===void 0?void 0:n.value;if(!c)return;const l=c[2],f=vn(l,o),h=[i,s,f,wn(t,a,c)];B(t.eav,[i,s],new Map([[f,h]]))}function Lr(t,e){var n,r;const[i,s]=e,o=Je(t,[i]);if(!o)return;const[a]=o,u=t.eav.get(a);if(u){for(const l of u.keys()){const f=t.attrs[l];(!s||!f||((n=f["forward-identity"])===null||n===void 0?void 0:n[1])===s)&&(oe(t.aev,[l,a]),oe(t.eav,[a,l]))}u.size===0&&oe(t.eav,[a])}const c=t.vae.get(a)&&ee(t.vae.get(a),2);c&&c.forEach(l=>{var f;const[h,v,b]=l,m=t.attrs[v];(!s||!m||((f=m["reverse-identity"])===null||f===void 0?void 0:f[1])===s)&&(oe(t.eav,[h,v,b]),oe(t.aev,[v,h,b]),oe(t.vae,[b,v,h]))}),((r=t.vae.get(a))===null||r===void 0?void 0:r.size)===0&&oe(t.vae,[a])}function mn(t,e){const n=bn(t.attrs,e);Object.keys(n).forEach(r=>{t[r]=n[r]})}function Nr(t,[e]){t.attrs[e.id]=e,jt(t)}function On(t){return ee(t.eav,3)}function Fr(t,[e]){if(!t.attrs[e])return;const n=On(t).filter(([r,i])=>i!==e);delete t.attrs[e],jt(t),mn(t,n)}function qr(t,[e]){const n=t.attrs[e.id];n&&(t.attrs[e.id]=Object.assign(Object.assign({},n),e),jt(t),mn(t,On(t)))}function zr(t,e){const[n,...r]=e;switch(n){case"add-triple":Ur(t,r);break;case"deep-merge-triple":$r(t,r);break;case"retract-triple":Ir(t,r);break;case"delete-entity":Lr(t,r);break;case"add-attr":Nr(t,r);break;case"delete-attr":Fr(t,r);break;case"update-attr":qr(t,r);break;default:throw new Error(`unhandled transaction action: ${n}`)}}function ee(t,e,n=[]){if(!t||e===0)return n;if(e===1){for(const r of t.values())n.push(r);return n}for(const r of t.values())ee(r,e-1,n);return n}function Qe(t,e,n){var r,i;const s=[];if(n!=null&&n.hasOwnProperty("$not")){for(const a of e.keys())n.$not!==a&&s.push(e.get(a));return s}if(n!=null&&n.hasOwnProperty("$isNull")){const{attrId:a,isNull:u,reverse:c}=n.$isNull;if(c)for(const l of e.keys()){const f=t.vae.get(l),h=!f||((r=f.get(a))===null||r===void 0?void 0:r.get(null))||!f.get(a);(u?h:!h)&&s.push(e.get(l))}else{const l=t.aev.get(a);for(const f of e.keys()){const h=!l||((i=l.get(f))===null||i===void 0?void 0:i.get(null))||!l.get(f);(u?h:!h)&&s.push(e.get(f))}}return s}if(n!=null&&n.$comparator)return ee(e,1).filter(n.$op);const o=n.in||n.$in||[n];for(const a of o){const u=e.get(a);u&&s.push(u)}return s}function Wr(t,e,n){let r="";return t!==void 0&&(r+="e"),e!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function Vr(t,[e,n,r]){var i,s;switch(Wr(e,n,r)){case"e":{const a=t.eav.get(e);return ee(a,2)}case"ea":{const a=(i=t.eav.get(e))===null||i===void 0?void 0:i.get(n);return ee(a,1)}case"eav":{const a=(s=t.eav.get(e))===null||s===void 0?void 0:s.get(n);return a?Qe(t,a,r):[]}case"ev":{const a=t.eav.get(e);if(!a)return[];const u=[];for(const c of a.values())u.push(...Qe(t,c,r));return u}case"a":{const a=t.aev.get(n);return ee(a,2)}case"av":{const a=t.aev.get(n);if(!a)return[];const u=[];for(const c of a.values())u.push(...Qe(t,c,r));return u}case"v":{const a=[];for(const u of t.eav.values())for(const c of u.values())a.push(...Qe(t,c,r))}default:return ee(t.eav,3)}}function Br(t,e,n){var r;const i=t.attrIndexes.blobAttrs.get(e),s={};for(const[o,a]of i.entries()){const u=(r=t.eav.get(n))===null||r===void 0?void 0:r.get(a.id),c=ee(u,1);for(const l of c)s[o]=l[2]}return s}function Ke(t,e,n){var r;return(r=t.attrIndexes.forwardIdents.get(e))===null||r===void 0?void 0:r.get(n)}function Sn(t,e,n){var r;return(r=t.attrIndexes.revIdents.get(e))===null||r===void 0?void 0:r.get(n)}function Jr(t,e){var n;const r=t.attrIndexes.primaryKeys.get(e);return r||((n=t.attrIndexes.forwardIdents.get(e))===null||n===void 0?void 0:n.get("id"))}function En(t,e){return Ar(t,n=>{e.forEach(r=>{zr(n,r)})})}function Qr(t){return typeof t=="string"&&t.startsWith("?")}function Kr(t,e,n){if(n.hasOwnProperty(t)){const r=n[t];return jn(r,e,n)}return Object.assign(Object.assign({},n),{[t]:e})}function Rn(t,e,n){return t===e?n:null}function Yr(t){switch(typeof t){case"string":return t.startsWith("?")?Kr:Rn;default:return Rn}}const Hr=["in","$in","$not","$isNull","$comparator"];function Gr(t){for(const e of Hr)if(t.hasOwnProperty(e))return!0;return!1}function jn(t,e,n){return n?typeof t=="object"?Gr(t)?n:null:Yr(t)(t,e,n):null}function Xr(t,e,n){return t.reduce((r,i,s)=>{const o=e[s];return jn(i,o,r)},n)}function Zr(t,e,n){return ni(t,e,n).map(r=>Xr(e,r,n)).filter(r=>r)}function ei(t,e,n){return e.or?e.or.patterns.flatMap(r=>Pt(t,r,n)):e.and?e.and.patterns.reduce((r,i)=>Pt(t,i,r),n):n.flatMap(r=>Zr(t,e,r))}function Pt(t,e,n=[{}]){return e.reduce((r,i)=>ei(t,i,r),n)}function Tt(t,e){return Array.isArray(e)?e.map(n=>Tt(t,n)):Qr(e)?t[e]:e}function ti(t,{find:e,where:n}){return Pt(t,n).map(i=>Tt(i,e))}function ni(t,e,n){return Vr(t,Tt(n,e))}let Ye;const ri=new Uint8Array(16);function ii(){if(!Ye&&(Ye=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ye))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ye(ri)}const L=[];for(let t=0;t<256;++t)L.push((t+256).toString(16).slice(1));function si(t,e=0){return L[t[e+0]]+L[t[e+1]]+L[t[e+2]]+L[t[e+3]]+"-"+L[t[e+4]]+L[t[e+5]]+"-"+L[t[e+6]]+L[t[e+7]]+"-"+L[t[e+8]]+L[t[e+9]]+"-"+L[t[e+10]]+L[t[e+11]]+L[t[e+12]]+L[t[e+13]]+L[t[e+14]]+L[t[e+15]]}const Cn={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function oi(t,e,n){if(Cn.randomUUID&&!e&&!t)return Cn.randomUUID();t=t||{};const r=t.random||(t.rng||ii)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,si(r)}function Pn(t){const e=t.replace(/-/g,""),n=[];for(let r=0;r<e.length;r+=2)n.push(parseInt(e.substring(r,r+2),16));return n}function ai(t,e){for(let n=0;n<t.length;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return 0}function ui(t,e){return ai(Pn(t),Pn(e))}function N(){return oi()}let ci=0;function xe(t){return He(`_${t}`,ci++)}function He(t,e){return`?${t}-${e}`}class Ee extends Error{constructor(e){super(e),this.name="AttrNotFoundError"}}function li(t,e){const n=Jr(t,e);if(!n)throw new Ee(`Could not find id attr for ${e}`);return n}function Tn(t,e,n,r){return[di(t,e,n,r)]}function di(t,e,n,r){return[t(n,r),li(e,n).id,t(n,r),t("time",r)]}function fi(t,e,n){return t.map(r=>r===e?n:r)}function An(t,e,n,r,i){const s=Ke(e,n,i),o=Sn(e,n,i),a=s||o;if(!a)throw new Ee(`Could not find attr for ${[n,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[u,c]=a["forward-identity"],[l,f]=a["reverse-identity"],h=r+1,v=s?[t(c,r),a.id,t(f,h),xe("time")]:[t(c,h),a.id,t(f,r),xe("time")];return[s?f:c,h,v,a,!!s]}function xn(t,e){if(typeof e!="string")return function(s){return!1};const n=e.replace(/%/g,".*").replace(/_/g,"."),r=new RegExp(`^${n}$`,t?void 0:"i");return function(s){return typeof s!="string"?!1:r.test(s)}}function hi(t,e){if(typeof e!="object"||e.hasOwnProperty("$in")||e.hasOwnProperty("in"))return e;const n=t["checked-data-type"]==="date";if(e.hasOwnProperty("$gt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>new Date(e.$gt)}:function(i){return i[2]>e.$gt}};if(e.hasOwnProperty("$gte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>=new Date(e.$gte)}:function(i){return i[2]>=e.$gte}};if(e.hasOwnProperty("$lt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<new Date(e.$lt)}:function(i){return i[2]<e.$lt}};if(e.hasOwnProperty("$lte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<=new Date(e.$lte)}:function(i){return i[2]<=e.$lte}};if(e.hasOwnProperty("$like")){const r=xn(!0,e.$like);return{$comparator:!0,$op:function(s){return r(s[2])}}}if(e.hasOwnProperty("$ilike")){const r=xn(!1,e.$ilike);return{$comparator:!0,$op:function(s){return r(s[2])}}}return e}function pi(t,e,n,r,i,s){const o=Ke(e,n,i),a=Sn(e,n,i),u=o||a;if(!u)throw new Ee(`No attr for etype = ${n} label = ${i}`);if(s!=null&&s.hasOwnProperty("$isNull")){const c=Ke(e,n,"id");if(!c)throw new Ee(`No attr for etype = ${n} label = id`);return[t(n,r),c.id,{$isNull:{attrId:u.id,isNull:s.$isNull,reverse:!o}},xe("time")]}return o?[t(n,r),u.id,hi(u,s),xe("time")]:[s,u.id,t(n,r),xe("time")]}function vi(t,e,n,r,i){const[s,o,a]=i.reduce((u,c)=>{const[l,f,h]=u,[v,b,m]=An(t,e,l,f,c);return[v,b,[...h,m]]},[n,r,[]]);return[s,o,a]}function At(t,e,n,r,i,s){const o=i.slice(0,i.length-1),a=i[i.length-1],[u,c,l]=vi(t,e,n,r,o),f=pi(t,e,u,c,a,s);return l.concat([f])}function _i(t,e){return e?[e].concat(t):t}function yi([t,e]){return t==="or"&&Array.isArray(e)}function bi([t,e]){return t==="and"&&Array.isArray(e)}function gi(t,e,n){return(r,i)=>r==e?t(r,i):`${t(r,i)}-${n}`}function Mn(t,e,n,r,i,s){const o=s.map((u,c)=>{const l=gi(t,r,c);return In(l,n,r,i,u)}),a=t(r,i);return{[e]:{patterns:o,joinSym:a}}}function wi(t){const e=[];for(let n=1;n<=t.length;n++)e.push(t.slice(0,n));return e}function kn(t,e,n,r,i){return wi(i).map(s=>At(t,e,n,r,s,{$isNull:!0}))}function In(t,e,n,r,i){return Object.entries(i).flatMap(([s,o])=>{if(yi([s,o]))return Mn(t,"or",e,n,r,o);if(bi([s,o]))return Mn(t,"and",e,n,r,o);const a=s.split(".");if(o!=null&&o.hasOwnProperty("$not")){const u=At(t,e,n,r,a,o),c=kn(t,e,n,r,a);return[{or:{patterns:[u,...c],joinSym:t(n,r)}}]}return o!=null&&o.hasOwnProperty("$isNull")&&o.$isNull===!0&&a.length>1?[{or:{patterns:kn(t,e,n,r,a),joinSym:t(n,r)}}]:At(t,e,n,r,a,o)})}function mi(t,e,n,r){const i=He;return r?In(i,t,e,n,r).concat(Tn(i,t,e,n)):Tn(i,t,e,n)}function Oi(t,e,n){return[t(e,n),t("time",n)]}function Si(t,e,n,r,i,s){const[o,a,u,c,l]=An(t,e,n,r,i),f=fi(u,t(n,r),s);return[o,a,f,c,l]}function Ei(t,e,{etype:n,level:r,form:i},s){const o=Object.keys(i).filter(a=>a!=="$");return o.length?Object.entries(s).map(function([u,c]){return o.map(function(h){var v,b,m;const E=!!(e.cardinalityInference&&(!((m=(b=(v=e.linkIndex)===null||v===void 0?void 0:v[n])===null||b===void 0?void 0:b[h])===null||m===void 0)&&m.isSingular));try{const[S,y,g]=Si(t,e,n,r,h,u),k=Dn(e,{etype:S,level:y,form:i[h],join:g}),O=E?k[0]:k;return{[h]:O}}catch(S){if(S instanceof Ee)return{[h]:E?void 0:[]};throw S}}).reduce(function(h,v){return Object.assign(Object.assign({},h),v)},c)}):Object.values(s)}function Ge([t,e],[n,r]){return e===r||e==null&&r==null?ui(t,n):r==null?1:e==null?-1:e>r?1:-1}function xt(t){return t==null?t:new Date(t).getTime()}function Ri(t,e,n,r){var i;const[s,o,a,u]=t,c=n==="desc"?1:-1;if(((i=e["forward-identity"])===null||i===void 0?void 0:i[2])==="id")return Ge(r,[s,u])===c;const[l,f]=r,h=e["checked-data-type"]==="date"?xt(f):f,v=e["checked-data-type"]==="date"?xt(a):a;return Ge([l,h],[s,v])===c}function ji(t,e){const n=e[1];return t.attrs[n]}function Ci(t,e,n){const r=Object.keys(n)[0];return Ke(t,e,r)}function Pi(t,e,n,r){if(n)return ji(t,n);if(r)return Ci(t,e,r)}function Ti(t,e,n,r,i,s){var o;let a=ti(t,s);const u=r==null?void 0:r["start-cursor"],c=Pi(t,e,u,i);if(c&&((o=c==null?void 0:c["forward-identity"])===null||o===void 0?void 0:o[2])!=="id"){const f=c["checked-data-type"]==="date",h=c.id;a=a.map(([v])=>{var b,m,E,S,y;let g=(y=(S=(E=(m=(b=t.eav.get(v))===null||b===void 0?void 0:b.get(h))===null||m===void 0?void 0:m.values())===null||E===void 0?void 0:E.next())===null||S===void 0?void 0:S.value)===null||y===void 0?void 0:y[2];return f&&(g=xt(g)),[v,g]})}a.sort(n==="asc"?function(h,v){return Ge(h,v)}:function(h,v){return Ge(v,h)});let l={};for(const f of a){const[h]=f;if(l[h]||u&&c&&Ri(u,c,n,f))continue;const v=Br(t,e,h);v&&(l[h]=v)}return l}function Ai(t){var e;const n=(e=t.$)===null||e===void 0?void 0:e.order;return n&&n[Object.keys(n)[0]]||"asc"}function xi(t,{etype:e,level:n,form:r,join:i,pageInfo:s}){var o,a,u,c,l,f,h,v;const b=((o=r.$)===null||o===void 0?void 0:o.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((u=r.$)===null||u===void 0?void 0:u.last),m=(c=r.$)===null||c===void 0?void 0:c.offset,E=(l=r.$)===null||l===void 0?void 0:l.before,S=(f=r.$)===null||f===void 0?void 0:f.after,y=(h=r.$)===null||h===void 0?void 0:h.order;if((m||E||S)&&(!s||!s["start-cursor"]))return[];const g=_i(mi(t,e,n,(v=r.$)===null||v===void 0?void 0:v.where),i),k=Oi(He,e,n),O=Ti(t,e,Ai(r),s,y,{where:g,find:k});if(b!=null){const U=Object.entries(O);return U.length<=b?O:Object.fromEntries(U.slice(0,b))}return O}function Mi(t,e){try{return xi(t,e)}catch(n){if(n instanceof Ee)return{};throw n}}function Dn(t,e){const n=Mi(t,e);return Ei(He,t,e,n)}function ki(t){const e={};for(const[n,r]of Object.entries(t))e[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return e}function Ii({store:t,pageInfo:e,aggregate:n},r){const s={data:Object.keys(r).reduce(function(a,u){return n!=null&&n[u]||(a[u]=Dn(t,{etype:u,form:r[u],level:0,pageInfo:e==null?void 0:e[u]})),a},{})};return e&&(s.pageInfo=ki(e)),n&&(s.aggregate=n),s}function Mt(t,e,n){return new Proxy({},{get:(r,i)=>i==="__ops"?n:s=>Mt(t,e,[...n,[i,t,e,s]])})}function Di(t,e){return`lookup__${t}__${JSON.stringify(e)}`}function kt(t){return t.startsWith("lookup__")}function Un(t){const[e,n,...r]=t.split("__");return[n,JSON.parse(r.join("__"))]}function Ui(t){return new Proxy({},{get(e,n){return kt(n)?Mt(t,Un(n),[]):Mt(t,n,[])}})}function It(){return new Proxy({},{get(t,e){return Ui(e)}})}const $i=It();function Li(t){return t.__ops}function Ni(t,e){const{attrIdMap:n,refSwapAttrIds:r}=t,i=[];for(const o of e){const a=n[o];if(a)i.push(a);else if(Array.isArray(o)&&o.length==2&&n[o[0]]){const[u,c]=o;i.push([n[u],c])}else i.push(o)}const[s]=e;if((s==="add-triple"||s==="retract-triple")&&r.has(e[2])){const o=i[1];i[1]=i[3],i[3]=o}return i}function J(t,e,n){return Object.values(t).find(r=>{const[i,s,o]=r["forward-identity"];return s===e&&o===n})}function ge(t,e,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[s,o,a]=i;return o===e&&a===n})}function Fi(t){if(Array.isArray(t))return t;const e=Object.entries(t);if(e.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return e[0]}function Dt(t,e,n){return n.indexOf(".")!==-1&&!J(t,e,n)}function Ut(t){const[e,n,...r]=t.split(".");if(r.length>0||n!=="id")throw new Error(`${t} is not a valid lookup attribute.`);return e}function qi(t,e,n){if(!Dt(t,e,n))return J(t,e,n);const r=Ut(n),i=J(t,e,r)||ge(t,e,r);if(i&&i["value-type"]!=="ref")throw new Error(`${n} does not reference a valid link attribute.`);return i}function $t(t){return typeof t=="string"&&!kt(t)?null:typeof t=="string"&&kt(t)?Un(t):Fi(t)}function te(t,e,n){const r=$t(n);if(r===null)return n;const[i,s]=r,o=qi(t,e,i);if(!o||!o["unique?"])throw new Error(`${i} is not a unique attribute.`);return[o.id,s]}function zi(t,[e,n,r]){return Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],u=J(t,e,s),c=ge(t,e,s);return a.map(l=>u?["add-triple",te(t,e,n),u.id,te(t,u["reverse-identity"][1],l)]:["add-triple",te(t,c["forward-identity"][1],l),c.id,te(t,e,n)])})}function Wi(t,[e,n,r]){return Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],u=J(t,e,s),c=ge(t,e,s);return a.map(l=>u?["retract-triple",te(t,e,n),u.id,te(t,u["reverse-identity"][1],l)]:["retract-triple",te(t,c["forward-identity"][1],l),c.id,te(t,e,n)])})}function Vi(t,[e,n,r]){const i=te(t,e,n);return[["id",te(t,e,n)]].concat(Object.entries(r)).map(([o,a])=>{const u=J(t,e,o);return["add-triple",i,u.id,a]})}function Bi(t,[e,n]){return[["delete-entity",te(t,e,n),e]]}function Ji(t,[e,n,r]){const i=te(t,e,n),s=Object.entries(r).map(([a,u])=>{const c=J(t,e,a),l=_n(u,void 0,null);return["deep-merge-triple",i,c.id,l]});return[["add-triple",i,J(t,e,"id").id,i]].concat(s)}function Qi(t){const[e,n,r,i]=t;if(!i)return t;const s=Object.assign({},i);return delete s.id,[e,n,r,s]}function Ki(t,e){const[n,...r]=Qi(e);switch(n){case"merge":return Ji(t,r);case"update":return Vi(t,r);case"link":return zi(t,r);case"unlink":return Wi(t,r);case"delete":return Bi(t,r);default:throw new Error(`unsupported action ${n}`)}}function Yi(t){switch(t){case"string":case"date":case"boolean":case"number":return t;default:return}}function Hi(t,e,n){var r,i;const s=(i=(r=t.entities[e])===null||r===void 0?void 0:r.attrs)===null||i===void 0?void 0:i[n];if(n==="id")return null;if(!s)throw new Error(`${e}.${n} does not exist in your schema`);const{unique:o,indexed:a}=s==null?void 0:s.config,u=Yi(s==null?void 0:s.valueType);return{"index?":a,"unique?":o,"checked-data-type":u}}function Lt(t,e,n,r){const i=t?Hi(t,e,n):null,s=N(),a=[N(),e,n];return Object.assign(Object.assign({id:s,"forward-identity":a,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}function Gi(t,e,n){return Object.values(t.links).find(i=>i.forward.on===e&&i.forward.label===n||i.reverse.on===e&&i.reverse.label===n)}function Xi(t,e,n){const r=Gi(t,e,n);if(!r)throw new Error(`Couldn't find the link ${e}.${n} in your schema`);const{forward:i,reverse:s}=r;return{"forward-identity":[N(),i.on,i.label],"reverse-identity":[N(),s.on,s.label],cardinality:i.has==="one"?"one":"many","unique?":s.has==="one"}}function $n(t,e,n,r){const i=t?Xi(t,e,n):null,s=N(),o=[N(),e,n],a=[N(),n,e];return Object.assign(Object.assign({id:s,"forward-identity":o,"reverse-identity":a,"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}const Zi=new Set(["update","merge","link","unlink"]),es=new Set(["link","unlink"]),ts=new Set(["update","merge"]),ns=new Set(["link","unlink","update","merge","delete"]),Nt={"unique?":!0,"index?":!0},rs=Object.assign(Object.assign({},Nt),{cardinality:"one"});function is(t){const e=[],[n,r,i,s]=t;if(!ns.has(n))return e;const o=$t(i);if(o&&e.push({etype:r,lookupPair:o}),n==="link")for(const[a,u]of Object.entries(s)){const c=Array.isArray(u)?u:[u];for(const l of c){const f=$t(l);f&&e.push({etype:r,lookupPair:f,linkLabel:a})}}return e}function ss({attrs:t,schema:e},n){var r,i;const[s,o,a]=[new Set,Object.assign({},t),[]];function u(f){o[f.id]=f,a.push(["add-attr",f]),s.add(f.id)}function c(f){f!=null&&f.isUnsynced&&!s.has(f.id)&&(a.push(["add-attr",f]),s.add(f.id))}function l(f,h){const v=J(o,f,h),b=ge(o,f,h);c(v),c(b),!v&&!b&&u($n(e,f,h,rs))}for(const f of n)for(const{etype:h,lookupPair:v,linkLabel:b}of is(f)){const m=v[0];if(b){l(h,b);const E=J(o,h,b),S=ge(o,h,b);c(E),c(S);const y=((r=E==null?void 0:E["reverse-identity"])===null||r===void 0?void 0:r[1])||((i=S==null?void 0:S["forward-identity"])===null||i===void 0?void 0:i[1])||b;if(Dt(o,y,m))l(y,Ut(m));else{const g=J(o,y,m);g||u(Lt(e,y,m,Nt)),c(g)}}else if(Dt(o,h,m))l(h,Ut(m));else{const E=J(o,h,m);E||u(Lt(e,h,m,Nt)),c(E)}}for(const f of n){const[h,v,b,m]=f;if(Zi.has(h)){const E=Object.keys(m);E.push("id");for(const S of E){const y=J(o,v,S);if(c(y),ts.has(h)&&(y||u(Lt(e,v,S,S==="id"?{"unique?":!0}:null))),es.has(h)){const g=ge(o,v,S);!y&&!g&&u($n(e,v,S)),c(g)}}}}return[o,a]}function os(t,e){const r=(Array.isArray(e)?e:[e]).flatMap(a=>Li(a)),[i,s]=ss(t,r),o=r.flatMap(a=>Ki(i,a));return[...s,...o]}var Ln=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};class Nn{constructor(e){this.dbName=e,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((e,n)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{n(i)},r.onsuccess=i=>{e(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(e){return Ln(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(e);a.onerror=u=>{i(u)},a.onsuccess=u=>{a.result?r(a.result):r(null)}})})}setItem(e,n){return Ln(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,s)=>{const u=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,e);u.onerror=c=>{s(c)},u.onsuccess=c=>{i()}})})}}var as=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};class Fn{static getIsOnline(){return as(this,void 0,void 0,function*(){return navigator.onLine})}static listen(e){const n=()=>{e(!0)},r=()=>{e(!1)};return addEventListener("online",n),addEventListener("offline",r),()=>{removeEventListener("online",n),removeEventListener("offline",r)}}}var us=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};function pe(t,e){return us(this,void 0,void 0,function*(){const n=yield fetch(t,e),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject({status:n.status,body:r})})}var Me=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};function cs({apiURI:t,appId:e,email:n}){return pe(`${t}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:n})})}function ls(t){return Me(this,arguments,void 0,function*({apiURI:e,appId:n,email:r,code:i}){return yield pe(`${e}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,email:r,code:i})})})}function ds(t){return Me(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield pe(`${e}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function qn(t){return Me(this,arguments,void 0,function*({apiURI:e,appId:n,code:r,codeVerifier:i}){return yield pe(`${e}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i})})})}function fs(t){return Me(this,arguments,void 0,function*({apiURI:e,appId:n,nonce:r,idToken:i,clientName:s,refreshToken:o}){return yield pe(`${e}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:s,refresh_token:o})})})}function hs(t){return Me(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield pe(`${e}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,refresh_token:r})})})}var Xe=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};function ps(t){return Xe(this,arguments,void 0,function*({apiURI:e,appId:n,fileName:r,refreshToken:i,metadata:s={}}){const{data:o}=yield pe(`${e}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return o})}function vs(t,e){return Xe(this,void 0,void 0,function*(){return(yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}})).ok})}function _s(t){return Xe(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield pe(`${e}/storage/signed-download-url?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}function ys(t){return Xe(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield pe(`${e}/storage/files?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}function zn(t,e){if(!e)return t;const n={};return e.forEach(r=>{n[r]=t[r]}),n}function bs(t,e,n){var r,i;const s={peers:{}};if(e&&"user"in e?e.user:!0){const a=zn((r=t.user)!==null&&r!==void 0?r:{},e==null?void 0:e.keys);s.user=Object.assign(Object.assign({},a),{peerId:n})}for(const a of Object.keys((i=t.peers)!==null&&i!==void 0?i:{})){const u=(e==null?void 0:e.peers)===void 0,c=Array.isArray(e==null?void 0:e.peers)&&(e==null?void 0:e.peers.includes(a));if(u||c){const l=zn(t.peers[a],e==null?void 0:e.keys);s.peers[a]=Object.assign(Object.assign({},l),{peerId:a})}}return s}function gs(t,e){if(t.isLoading!==e.isLoading||t.error!==e.error||(t.user||e.user)&&(!t.user||!e.user||!pn(t.user,e.user))||!hn(t.peers,e.peers))return!0;for(const r of Object.keys(t.peers))if(!pn(t.peers[r],e.peers[r]))return!0;return!1}class Wn{constructor(){this.promise=new Promise((e,n)=>{this._resolve=e,this._reject=n})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}var Ze=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};class Vn{constructor(e,n,r,i,s=u=>JSON.stringify(u),o=u=>JSON.parse(u),a=100){this._subs=[],this._persister=e,this._key=n,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=s,this.fromJSON=o,this._saveThrottleMs=a,this._pendingSaveCbs=[],this._version=0,this._load()}_load(){return Ze(this,void 0,void 0,function*(){const e=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(e,this.currentValue);for(const n of this._loadedCbs)n()})}waitForLoaded(){return Ze(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(n=>{this._loadedCbs.push(n)})})}isLoading(){return this._isLoading}version(){return this._version}waitForSync(){return Ze(this,void 0,void 0,function*(){if(!this._nextSave)return;yield new Promise(n=>{this._pendingSaveCbs.push(n)})})}_writeToStorage(){this._persister.setItem(this._key,this.toJSON(this.currentValue));for(const e of this._pendingSaveCbs)e();this._pendingSaveCbs.length=0}flush(){return Ze(this,void 0,void 0,function*(){this._nextSave&&(clearTimeout(this._nextSave),this._writeToStorage())})}_enqueuePersist(e){if(this._nextSave){e&&this._pendingSaveCbs.push(e);return}this._nextSave=setTimeout(()=>{this._nextSave=null,this._writeToStorage()},this._saveThrottleMs)}set(e,n){this._version++,this.currentValue=e(this.currentValue),this._isLoading?this._loadedCbs.push(()=>this._enqueuePersist(n)):this._enqueuePersist(n);for(const r of this._subs)r(this.currentValue)}subscribe(e){return this._subs.push(e),e(this.currentValue),()=>{this._subs=this._subs.filter(n=>n!==e)}}}function Bn(t,e=[]){t.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":s}=i;for(const o of s)for(const a of o)e.push(a);Bn(n["child-nodes"],e)})}function Jn(t){const e=[];return Bn(t,e),e}function ws(t){return Object.values(t.links).reduce((e,n)=>{var r,i,s,o;return(r=e[s=n.forward.on])!==null&&r!==void 0||(e[s]={}),e[n.forward.on][n.forward.label]={isForward:!0,isSingular:n.forward.has==="one",link:n},(i=e[o=n.reverse.on])!==null&&i!==void 0||(e[o]={}),e[n.reverse.on][n.reverse.label]={isForward:!1,isSingular:n.reverse.has==="one",link:n},e},{})}const Qn="v0.17.3";var F=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?s(l.value):i(l.value).then(a,u)}c((r=r.apply(t,e||[])).next())})};const we={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},ms=3e4,Os=0,Kn=1,Ss={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},Ft="_instant_oauth_redirect",qt="currentUser";let Es=0;function Rs(t){const e=new WebSocket(t);return e._id=Es++,e}function js(){return typeof window<"u"||typeof chrome<"u"}const Yn={"set-presence":!0,"set-presence-ok":!0,"refresh-presence":!0};function Cs(t){var e;const n=JSON.parse(t);for(const r in n){const i=n[r];!((e=i==null?void 0:i.result)===null||e===void 0)&&e.store&&(i.result.store=kr(i.result.store))}return n}function Ps(t){var e;const n={};for(const r in t){const i=t[r],s=Object.assign({},i);!((e=i.result)===null||e===void 0)&&e.store&&(s.result=Object.assign(Object.assign({},i.result),{store:Mr(i.result.store)})),n[r]=s}return JSON.stringify(n)}class Ts{constructor(e,n=Nn,r=Fn,i){this._isOnline=!0,this._isShutdown=!1,this.status=we.CONNECTING,this.queryCbs={},this.queryOnceDfds={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.connectionStatusCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._rooms={},this._roomsPendingLeave={},this._presence={},this._broadcastQueue=[],this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._beforeUnloadCbs=[],this._dataForQueryCache={},this._onMergeQuerySubs=(s,o)=>{const a=s||{},u=Object.assign({},o);Object.entries(o).forEach(([l,f])=>{var h;const v=(h=a==null?void 0:a[l])===null||h===void 0?void 0:h.result,b=f.result;v&&!b&&(u[l].result=v)}),Object.keys(a).filter(l=>!o[l]).slice(0,10).forEach(l=>{u[l]=a[l]}),this.querySubs.set(l=>u),this.loadedNotifyAll()},this._onMergePendingMutations=(s,o)=>{const a=new Map([...s.entries(),...o.entries()]);this.pendingMutations.set(c=>a),this.loadedNotifyAll(),this._rewriteMutations(this.attrs,s).forEach((c,l)=>{!o.has(l)&&!c["tx-id"]&&this._sendMutation(l,c)})},this.getPreviousResult=s=>{const o=Y(s);return this.dataForQuery(o)},this.notifyOne=s=>{var o,a;const u=(o=this.queryCbs[s])!==null&&o!==void 0?o:[],c=(a=this._dataForQueryCache[s])===null||a===void 0?void 0:a.data,l=this.dataForQuery(s);l&&(Ve(l,c)||u.forEach(f=>f.cb(l)))},this.notifyOneQueryOnce=s=>{var o;const a=(o=this.queryOnceDfds[s])!==null&&o!==void 0?o:[],u=this.dataForQuery(s);a.forEach(c=>{this._completeQueryOnce(c.q,s,c.dfd),c.dfd.resolve(u)})},this.notifyQueryError=(s,o)=>{(this.queryCbs[s]||[]).forEach(u=>u.cb({error:o}))},this.pushTx=s=>{try{const o=os({attrs:this.optimisticAttrs(),schema:this.config.schema},s);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(s,o)=>{const a=N(),u={op:"transact","tx-steps":s,error:o};this.pendingMutations.set(l=>(l.set(a,u),l));const c=new Wn;return this.mutationDeferredStore.set(a,c),this._sendMutation(a,u),this.notifyAll(),c.promise},this._wsOnOpen=s=>{const o=s.target;if(this._ws!==o){z.info("[socket][open]",o._id,"skip; this is no longer the current ws");return}z.info("[socket][open]",this._ws._id),this._setStatus(we.OPENED),this.getCurrentUser().then(a=>{var u;this._trySend(N(),{op:"init","app-id":this.config.appId,"refresh-token":(u=a.user)===null||u===void 0?void 0:u.refresh_token,versions:this.versions,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=s=>{const o=s.target,a=JSON.parse(s.data.toString());if(this._ws!==o){z.info("[socket][message]",o._id,a,"skip; this is no longer the current ws");return}this._handleReceive(o._id,JSON.parse(s.data.toString()))},this._wsOnError=s=>{const o=s.target;if(this._ws!==o){z.info("[socket][error]",o._id,"skip; this is no longer the current ws");return}z.error("[socket][error]",o._id,s)},this._wsOnClose=s=>{const o=s.target;if(this._ws!==o){z.info("[socket][close]",o._id,"skip; this is no longer the current ws");return}this._setStatus(we.CLOSED);for(const a of Object.values(this._rooms))a.isConnected=!1;if(this._isShutdown){z.info("[socket][close]",o._id,"Reactor has been shut down and will not reconnect");return}z.info("[socket][close]",o._id,"schedule reconnect, ms =",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){z.info("[socket][close]",o._id,"we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},Ss),e),this.versions=Object.assign(Object.assign({},i||{}),{"@instantdb/core":Qn}),this.config.schema&&(this._linkIndex=ws(this.config.schema)),js()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",s=>F(this,void 0,void 0,function*(){var o;if(((o=s.data)===null||o===void 0?void 0:o.type)==="auth"){const a=yield this.getCurrentUser();this.updateUser(a.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(n),this.getCurrentUser(),r.getIsOnline().then(s=>{this._isOnline=s,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(z.info("[network] online =",o),this._isOnline=o,this._isOnline&&this._startSocket())})}),typeof addEventListener<"u"&&(this._beforeUnload=this._beforeUnload.bind(this),addEventListener("beforeunload",this._beforeUnload)))}_initStorage(e){this._persister=new e(`instant_${this.config.appId}_5`),this.querySubs=new Vn(this._persister,"querySubs",{},this._onMergeQuerySubs,Ps,Cs),this.pendingMutations=new Vn(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,n=>JSON.stringify([...n.entries()]),n=>new Map(JSON.parse(n))),this._beforeUnloadCbs.push(()=>{this.pendingMutations.flush(),this.querySubs.flush()})}_beforeUnload(){for(const e of this._beforeUnloadCbs)e()}_finishTransaction(e,n,r){const i=this.mutationDeferredStore.get(n);this.mutationDeferredStore.delete(n);const s=e!=="error"&&e!=="timeout";!i&&!s&&console.error("Mutation failed",Object.assign({status:e,clientId:n},r)),i&&(s?i.resolve({status:e,clientId:n}):i.reject(Object.assign({status:e,clientId:n},r)))}_setStatus(e,n){this.status=e,this._errorMessage=n,this.notifyConnectionStatusSubs(e)}_flushEnqueuedRoomData(e){var n,r;const i=(r=(n=this._presence[e])===null||n===void 0?void 0:n.result)===null||r===void 0?void 0:r.user,s=this._broadcastQueue[e];if(this._broadcastQueue[e]=[],i&&this._trySetPresence(e,i),s)for(const o of s){const{topic:a,roomType:u,data:c}=o;this._tryBroadcast(e,u,a,c)}}_handleReceive(e,n){var r,i,s,o;const a=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(Yn[n.op]||z.info("[receive]",e,n.op,n),n.op){case"init-ok":this._setStatus(we.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(n.attrs),this._flushPendingMessages(),this._sessionId=n["session-id"];for(const T of Object.keys(this._rooms))this._tryJoinRoom(T);break;case"add-query-exists":this.notifyOneQueryOnce(Y(n.q));break;case"add-query-ok":const{q:u,result:c}=n,l=Y(u),f=(i=(r=c==null?void 0:c[0])===null||r===void 0?void 0:r.data)===null||i===void 0?void 0:i["page-info"],h=(o=(s=c==null?void 0:c[0])===null||s===void 0?void 0:s.data)===null||o===void 0?void 0:o.aggregate,v=Jn(c),b=Ct(this.attrs,v,a,this._linkIndex);this.querySubs.set(T=>(T[l].result={store:b,pageInfo:f,aggregate:h},T)),this.notifyOne(l),this.notifyOneQueryOnce(l);break;case"refresh-ok":const{computations:m,attrs:E}=n;this._setAttrs(E);const S=m.map(T=>{var $,le,ne,re;const Re=T["instaql-query"],de=T["instaql-result"],st=Y(Re),ot=Jn(de),at=Ct(this.attrs,ot,a,this._linkIndex),Vt=(le=($=de==null?void 0:de[0])===null||$===void 0?void 0:$.data)===null||le===void 0?void 0:le["page-info"],Bt=(re=(ne=de==null?void 0:de[0])===null||ne===void 0?void 0:ne.data)===null||re===void 0?void 0:re.aggregate;return{hash:st,store:at,pageInfo:Vt,aggregate:Bt}});S.forEach(({hash:T,store:$,pageInfo:le,aggregate:ne})=>{this.querySubs.set(re=>(re[T].result={store:$,pageInfo:le,aggregate:ne},re))}),S.forEach(({hash:T})=>{this.notifyOne(T)});break;case"transact-ok":const{"client-event-id":y,"tx-id":g}=n,O=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(y);if(!O)break;this.pendingMutations.set(T=>(T.delete(y),T));const U=O["tx-steps"];this.querySubs.set(T=>{var $;for(const[le,ne]of Object.entries(T)){const re=($=ne==null?void 0:ne.result)===null||$===void 0?void 0:$.store;if(!re)continue;const Re=En(re,U);T[le].result.store=Re}return T});const Q=O["tx-steps"].filter(([T,...$])=>T==="add-attr").map(([T,$])=>$).concat(Object.values(this.attrs));this._setAttrs(Q),this._finishTransaction("synced",y);break;case"refresh-presence":const ce=n["room-id"];this._setPresencePeers(ce,n.data),this._notifyPresenceSubs(ce);break;case"server-broadcast":const De=n["room-id"],rt=n.topic;this._notifyBroadcastSubs(De,rt,n);break;case"join-room-ok":const ve=n["room-id"],it=this._rooms[ve];if(!it){this._roomsPendingLeave[ve]&&(this._tryLeaveRoom(ve),delete this._roomsPendingLeave[ve]);break}it.isConnected=!0,this._notifyPresenceSubs(ve),this._flushEnqueuedRoomData(ve);break;case"join-room-error":const Ue=n["room-id"],Z=this._rooms[Ue];Z&&(Z.error=n.error),this._notifyPresenceSubs(Ue);break;case"error":this._handleReceiveError(n);break}}_handleMutationError(e,n,r){const i=this.pendingMutations.currentValue.get(n);i&&(e!=="timeout"||!i["tx-id"])&&(this.pendingMutations.set(s=>(s.delete(n),s)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(r),this._finishTransaction(e,n,r))}_handleReceiveError(e){var n,r,i,s;const o=e["client-event-id"],a=this.pendingMutations.currentValue.get(o),u={message:e.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};if(e.hint&&(u.hint=e.hint),a){const h={message:e.message,hint:e.hint};this._handleMutationError("error",o,h);return}const c=(n=e["original-event"])===null||n===void 0?void 0:n.q;if(c&&((r=e["original-event"])===null||r===void 0?void 0:r.op)==="add-query"){const h=Y(c);this.notifyQueryError(Y(c),u),this.notifyQueryOnceError(c,h,o,u);return}if(((i=e["original-event"])===null||i===void 0?void 0:i.op)==="init"){if(e.type==="record-not-found"&&((s=e.hint)===null||s===void 0?void 0:s["record-type"])==="app-user"){this.changeCurrentUser(null);return}this._setStatus(we.ERRORED,u),this.notifyAll();return}const f=Object.assign({},e);delete f.message,delete f.hint,console.error(e.message,f),e.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,e.hint)}notifyQueryOnceError(e,n,r,i){var s;const o=(s=this.queryOnceDfds[n])===null||s===void 0?void 0:s.find(a=>a.eventId===r);o&&(o.dfd.reject(i),this._completeQueryOnce(e,n,o.dfd))}_setAttrs(e){this.attrs=e.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}_startQuerySub(e,n){const r=N();return this.querySubs.set(i=>(i[n]=i[n]||{q:e,result:null,eventId:r},i)),this._trySendAuthed(r,{op:"add-query",q:e}),r}subscribeQuery(e,n){var r;const i=Y(e),s=this.getPreviousResult(e);return s&&n(s),this.queryCbs[i]=(r=this.queryCbs[i])!==null&&r!==void 0?r:[],this.queryCbs[i].push({q:e,cb:n}),this._startQuerySub(e,i),()=>{this._unsubQuery(e,i,n)}}queryOnce(e){var n;const r=new Wn;if(!this._isOnline)return r.reject(new Error("We can't run `queryOnce`, because the device is offline.")),r.promise;if(!this.querySubs)return r.reject(new Error("We can't run `queryOnce` on the backend. Use adminAPI.query instead: https://www.instantdb.com/docs/backend#query")),r.promise;const i=Y(e),s=this._startQuerySub(e,i);return this.queryOnceDfds[i]=(n=this.queryOnceDfds[i])!==null&&n!==void 0?n:[],this.queryOnceDfds[i].push({q:e,dfd:r,eventId:s}),setTimeout(()=>r.reject(new Error("Query timed out")),ms),r.promise}_completeQueryOnce(e,n,r){this.queryOnceDfds[n]&&(this.queryOnceDfds[n]=this.queryOnceDfds[n].filter(i=>i.dfd!==r),this._cleanupQuery(e,n))}_unsubQuery(e,n,r){this.queryCbs[n]&&(this.queryCbs[n]=this.queryCbs[n].filter(i=>i.cb!==r),this._cleanupQuery(e,n))}_cleanupQuery(e,n){var r,i;!((r=this.queryCbs[n])===null||r===void 0)&&r.length||!((i=this.queryOnceDfds[n])===null||i===void 0)&&i.length||(delete this.queryCbs[n],delete this.queryOnceDfds[n],this._trySendAuthed(N(),{op:"remove-query",q:e}))}_rewriteMutations(e,n){if(!e)return n;const r=u=>{const[c,l,f]=u["forward-identity"];return J(e,l,f)},i=u=>{const[c,l,f]=u["forward-identity"];return ge(e,l,f)},s={attrIdMap:{},refSwapAttrIds:new Set},o=u=>{const c=[];for(const l of u){const[f]=l;if(f==="add-attr"){const[v,b]=l,m=r(b);if(m){s.attrIdMap[b.id]=m.id;continue}if(b["value-type"]==="ref"){const E=i(b);if(E){s.attrIdMap[b.id]=E.id,s.refSwapAttrIds.add(b.id);continue}}}const h=Ni(s,l);c.push(h)}return c},a=new Map;for(const[u,c]of n.entries())a.set(u,Object.assign(Object.assign({},c),{"tx-steps":o(c["tx-steps"])}));return a}optimisticAttrs(){var e;const n=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(n.filter(([a,u])=>a==="delete-attr").map(([a,u])=>u)),i=[];for(const[a,u]of n)if(a==="add-attr")i.push(u);else if(a==="update-attr"&&u.id&&(!((e=this.attrs)===null||e===void 0)&&e[u.id])){const c=Object.assign(Object.assign({},this.attrs[u.id]),u);i.push(c)}const s=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(s.map(a=>[a.id,a]))}dataForQuery(e){const n=this._errorMessage;if(n)return{error:n};if(!this.querySubs||!this.pendingMutations)return;const r=this.querySubs.version(),i=this.querySubs.currentValue,s=this.pendingMutations.version(),o=this.pendingMutations.currentValue,{q:a,result:u}=i[e]||{};if(!u)return;const c=this._dataForQueryCache[e];if(c&&r===c.querySubVersion&&s===c.pendingMutationsVersion)return c.data;const{store:l,pageInfo:f,aggregate:h}=u,b=[...this._rewriteMutations(l.attrs,o).values()].flatMap(S=>S["tx-steps"]),m=En(l,b),E=Ii({store:m,pageInfo:f,aggregate:h},a);return this._dataForQueryCache[e]={querySubVersion:r,pendingMutationsVersion:s,data:E},E}notifyAll(){Object.keys(this.queryCbs).forEach(e=>{this.notifyOne(e)})}loadedNotifyAll(){this.pendingMutations.isLoading()||this.querySubs.isLoading()||this.notifyAll()}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(e,n){if(n.error){this._handleMutationError("error",e,{error:n.error,message:n.error.message});return}if(this.status!==we.AUTHENTICATED){this._finishTransaction("enqueued",e);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(e,n),setTimeout(()=>{this._finishTransaction("pending",e)},3e3),setTimeout(()=>{this._isOnline&&this._handleMutationError("timeout",e,{message:"transaction timed out"})},r)):this._finishTransaction("enqueued",e)}_flushPendingMessages(){Object.keys(this.queryCbs).map(i=>this.querySubs.currentValue[i]).filter(i=>i).forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),Object.values(this.queryOnceDfds).flat().forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((i,s)=>{i["tx-id"]||this._sendMutation(s,i)})}_trySendAuthed(...e){this.status===we.AUTHENTICATED&&this._trySend(...e)}_trySend(e,n,r){this._ws.readyState===Kn&&(Yn[n.op]||z.info("[send]",this._ws._id,n.op,n),this._ws.send(JSON.stringify(Object.assign({"client-event-id":e},n))))}_startSocket(){if(this._ws&&this._ws.readyState==Os){z.info("[socket][start]",this._ws._id,"maintained as current ws, we were still in a connecting state");return}const e=this._ws;this._ws=Rs(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose,this._ws.onerror=this._wsOnError,z.info("[socket][start]",this._ws._id),(e==null?void 0:e.readyState)===Kn&&(z.info("[socket][start]",this._ws._id,"close previous ws id = ",e._id),e.close())}getLocalId(e){return F(this,void 0,void 0,function*(){const n=`localToken_${e}`,r=yield this._persister.getItem(n);if(r)return r;if(this._localIdPromises[n])return this._localIdPromises[n];const i=N();return this._localIdPromises[n]=this._persister.setItem(n,i).then(()=>i),this._localIdPromises[n]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const e=new URL(window.location.href);if(e.searchParams.get(Ft)){const n=e.toString();e.searchParams.delete(Ft),e.searchParams.delete("code"),e.searchParams.delete("error");const r=e.pathname+(e.searchParams.size?"?"+e.searchParams:"")+e.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const s=o=>{var a;i||(i=!0,navigation.removeEventListener("navigate",s),!o.userInitiated&&o.navigationType==="replace"&&((a=o.destination)===null||a===void 0?void 0:a.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",s)}}}_oauthLoginInit(){return F(this,void 0,void 0,function*(){var e,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const s=new URLSearchParams(window.location.search);if(!s.get(Ft))return null;const o=s.get("error");if(o)return this._replaceUrlAfterOAuth(),{error:{message:o}};const a=s.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:u}=yield qn({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(u),null}catch(u){return((e=u==null?void 0:u.body)===null||e===void 0?void 0:e.type)==="record-not-found"&&((r=(n=u==null?void 0:u.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=u==null?void 0:u.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return F(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(e){return this.mutationErrorCbs.push(e),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==e)}}subscribeAuth(e){this.authCbs.push(e);const n=this._currentUserCached;n.isLoading||e(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||Ve(i,n)||e(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==e)}}subscribeConnectionStatus(e){return this.connectionStatusCbs.push(e),()=>{this.connectionStatusCbs=this.connectionStatusCbs.filter(n=>n!==e)}}subscribeAttrs(e){return this.attrsCbs.push(e),this.attrs&&e(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==e)}}notifyAuthSubs(e){this.authCbs.forEach(n=>n(e))}notifyMutationErrorSubs(e){this.mutationErrorCbs.forEach(n=>n(e))}notifyAttrsSubs(){if(!this.attrs)return;const e=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(e))}notifyConnectionStatusSubs(e){this.connectionStatusCbs.forEach(n=>n(e))}setCurrentUser(e){return F(this,void 0,void 0,function*(){yield this._persister.setItem(qt,JSON.stringify(e))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return F(this,void 0,void 0,function*(){const e=yield this._waitForOAuthCallbackResponse();if(e!=null&&e.error){const i={error:e.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const n=yield this._persister.getItem(qt),r={user:JSON.parse(n),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return F(this,void 0,void 0,function*(){const e=yield this._persister.getItem(qt);return JSON.parse(e)!=null})}changeCurrentUser(e){return F(this,void 0,void 0,function*(){var n;const{user:r}=yield this.getCurrentUser();if(!Ve(r,e)){yield this.setCurrentUser(e),this.updateUser(e);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(e){const n={error:void 0,user:e};this._currentUserCached=Object.assign({isLoading:!1},n),this._dataForQueryCache={},this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(n)}sendMagicCode({email:e}){return cs({apiURI:this.config.apiURI,appId:this.config.appId,email:e})}signInWithMagicCode(e){return F(this,arguments,void 0,function*({email:n,code:r}){const i=yield ls({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r});return yield this.changeCurrentUser(i.user),i})}signInWithCustomToken(e){return F(this,void 0,void 0,function*(){const n=yield ds({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:e});return yield this.changeCurrentUser(n.user),n})}signOut(){return F(this,void 0,void 0,function*(){var e;const n=yield this.getCurrentUser(),r=(e=n==null?void 0:n.user)===null||e===void 0?void 0:e.refresh_token;if(r)try{yield hs({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}yield this.changeCurrentUser(null)})}createAuthorizationURL({clientName:e,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${e}&redirect_uri=${n}`}exchangeCodeForToken(e){return F(this,arguments,void 0,function*({code:n,codeVerifier:r}){const i=yield qn({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r});return yield this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:e,appId:n}=this.config;return`${e}/runtime/${n}`}signInWithIdToken(e){return F(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){var s;const o=yield this.getCurrentUser(),a=(s=o==null?void 0:o.user)===null||s===void 0?void 0:s.refresh_token,u=yield fs({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i,refreshToken:a});return yield this.changeCurrentUser(u.user),u})}joinRoom(e){return this._rooms[e]||(this._rooms[e]={isConnected:!1,error:void 0}),this._presence[e]=this._presence[e]||{},this._tryJoinRoom(e),()=>{this._cleanupRoom(e)}}_cleanupRoom(e){var n,r,i,s;if(!(!((r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[e])!==null&&i!==void 0?i:{}).length){const o=(s=this._rooms[e])===null||s===void 0?void 0:s.isConnected;delete this._rooms[e],delete this._presence[e],delete this._broadcastSubs[e],o?this._tryLeaveRoom(e):this._roomsPendingLeave[e]=!0}}getPresence(e,n,r={}){const i=this._rooms[n],s=this._presence[n];return!i||!s||!s.result?null:Object.assign(Object.assign({},bs(s.result,r,this._sessionId)),{isLoading:!i.isConnected,error:i.error})}publishPresence(e,n,r){const i=this._rooms[n],s=this._presence[n];if(!i||!s)return;s.result=s.result||{};const o=Object.assign(Object.assign({},s.result.user),r);s.result.user=o,i.isConnected&&(this._trySetPresence(n,o),this._notifyPresenceSubs(n))}_trySetPresence(e,n){this._trySendAuthed(N(),{op:"set-presence","room-id":e,data:n})}_tryJoinRoom(e){this._trySendAuthed(N(),{op:"join-room","room-id":e}),delete this._roomsPendingLeave[e]}_tryLeaveRoom(e){this._trySendAuthed(N(),{op:"leave-room","room-id":e})}subscribePresence(e,n,r,i){const s=this.joinRoom(n),o=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(o),this._notifyPresenceSub(n,o),()=>{var a,u,c;this._presence[n].handlers=(c=(u=(a=this._presence[n])===null||a===void 0?void 0:a.handlers)===null||u===void 0?void 0:u.filter(l=>l!==o))!==null&&c!==void 0?c:[],s()}}_notifyPresenceSubs(e){var n,r;(r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(e,i)})}_notifyPresenceSub(e,n){const r=this.getPresence("",e,n);r&&(n.prev&&!gs(r,n.prev)||(n.prev=r,n.cb(r)))}_setPresencePeers(e,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([s,o])=>[s,o.data]));this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.peers=i}publishTopic({roomType:e,roomId:n,topic:r,data:i}){var s;const o=this._rooms[n];if(o){if(!o.isConnected){this._broadcastQueue[n]=(s=this._broadcastQueue[n])!==null&&s!==void 0?s:[],this._broadcastQueue[n].push({topic:r,roomType:e,data:i});return}this._tryBroadcast(n,e,r,i)}}_tryBroadcast(e,n,r,i){this._trySendAuthed(N(),{op:"client-broadcast","room-id":e,roomType:n,topic:r,data:i})}subscribeTopic(e,n,r){const i=this.joinRoom(e);return this._broadcastSubs[e]=this._broadcastSubs[e]||{},this._broadcastSubs[e][n]=this._broadcastSubs[e][n]||[],this._broadcastSubs[e][n].push(r),this._presence[e]=this._presence[e]||{},()=>{this._broadcastSubs[e][n]=this._broadcastSubs[e][n].filter(s=>s!==r),this._broadcastSubs[e][n].length||delete this._broadcastSubs[e][n],i()}}_notifyBroadcastSubs(e,n,r){var i,s,o;(o=(s=(i=this._broadcastSubs)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s[n])===null||o===void 0||o.forEach(a=>{var u,c,l,f,h,v;const b=(u=r.data)===null||u===void 0?void 0:u.data,m=r.data["peer-id"]===this._sessionId?(l=(c=this._presence[e])===null||c===void 0?void 0:c.result)===null||l===void 0?void 0:l.user:(v=(h=(f=this._presence[e])===null||f===void 0?void 0:f.result)===null||h===void 0?void 0:h.peers)===null||v===void 0?void 0:v[r.data["peer-id"]];return a(b,m)})}upload(e,n){return F(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),s=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,o=e||n.name,a=yield ps({apiURI:this.config.apiURI,appId:this.config.appId,fileName:o,refreshToken:s});return yield vs(a,n)})}getDownloadUrl(e){return F(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield _s({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}deleteFile(e){return F(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield ys({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}}class ue{constructor(e,n,r={indexed:!1,unique:!1}){this.valueType=e,this.required=n,this.config=r}optional(){return new ue(this.valueType,!1)}unique(){return new ue(this.valueType,this.required,Object.assign(Object.assign({},this.config),{unique:!0}))}indexed(){return new ue(this.valueType,this.required,Object.assign(Object.assign({},this.config),{indexed:!0}))}}class et{constructor(e,n){this.attrs=e,this.links=n}asType(){return new et(this.attrs,this.links)}}class tt{constructor(e,n,r){this.entities=e,this.links=n,this.rooms=r}withRoomSchema(){return new tt(this.entities,this.links,{})}}function As(t,e){return new tt(Hn(t,e),e,void 0)}function xs(t){return new et(t,{})}function Ms(){return new ue("string",!0)}function ks(){return new ue("number",!0)}function Is(){return new ue("boolean",!0)}function Ds(){return new ue("date",!0)}function Us(){return new ue("json",!0)}function $s(){return new ue("json",!0)}function Hn(t,e){var n,r,i,s;const o={fwd:{},rev:{}};for(const u of Object.values(e))(n=o.fwd)[r=u.forward.on]||(n[r]={}),(i=o.rev)[s=u.reverse.on]||(i[s]={}),o.fwd[u.forward.on][u.forward.label]={entityName:u.reverse.on,cardinality:u.forward.has},o.rev[u.reverse.on][u.reverse.label]={entityName:u.forward.on,cardinality:u.reverse.has};return Object.fromEntries(Object.entries(t).map(([u,c])=>[u,new et(c.attrs,Object.assign(Object.assign({},o.fwd[u]),o.rev[u]))]))}function Ls({entities:t,links:e,rooms:n}){const r=e??{},i=n??{};return new tt(Hn(t,r),r,i)}const Ns={graph:As,schema:Ls,entity:xs,string:Ms,number:ks,boolean:Is,date:Ds,json:Us,any:$s};let nt;function Fs(t){nt==null||nt.dispose();const e=Vs(),n=Ws(o),r=zs(qs(t));function i(c){var l;c.source===r.element.contentWindow&&((l=c.data)===null||l===void 0?void 0:l.type)==="close"&&e.isVisible()&&o()}function s(c){const l=c.shiftKey&&c.ctrlKey&&c.key==="0",f=c.key==="Escape"||c.key==="Esc";(l||f&&e.isVisible())&&o()}function o(){e.isVisible()?e.element.style.display="none":(e.element.style.display="block",e.element.contains(r.element)||e.element.appendChild(r.element))}function a(){e.element.remove(),n.element.remove(),removeEventListener("keydown",s),removeEventListener("message",i)}function u(){document.body.appendChild(e.element),document.body.appendChild(n.element),addEventListener("keydown",s),addEventListener("message",i),nt={dispose:a}}return u()}function qs(t){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${t}`}function zs(t){const e=document.createElement("iframe");return e.src=t,e.className="instant-devtool-iframe",Object.assign(e.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:e}}function Ws(t){const e=`
    <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,n=document.createElement("button");return n.innerHTML=e,n.className="instant-devtool-toggler",Object.assign(n.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),n.addEventListener("click",t),{element:n}}function Vs(){const t=document.createElement("div");Object.assign(t.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),t.style.display="none",t.className="instant-devtool-container";function e(){return t.style.display!=="none"}return{element:t,isVisible:e}}const Bs=!0,Js={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function Qs(){var t;return globalThis.__instantDbStore=(t=globalThis.__instantDbStore)!==null&&t!==void 0?t:{},globalThis.__instantDbStore}const zt=Qs();class Ks{constructor(e){this.db=e,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Ys{constructor(e){this.db=e,this.upload=(n,r)=>this.db.upload(n,r),this.put=this.upload,this.getDownloadUrl=n=>this.db.getDownloadUrl(n),this.delete=n=>this.db.deleteFile(n)}}function Hs(t){return JSON.parse(JSON.stringify(t))}class Gs{constructor(e){this.tx=It(),this._reactor=e,this.auth=new Ks(this._reactor),this.storage=new Ys(this._reactor)}transact(e){return this._reactor.pushTx(e)}getLocalId(e){return this._reactor.getLocalId(e)}subscribeQuery(e,n){return this._reactor.subscribeQuery(e,n)}subscribeAuth(e){return this._reactor.subscribeAuth(e)}subscribeConnectionStatus(e){return this._reactor.subscribeConnectionStatus(e)}joinRoom(e="_defaultRoomType",n="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(n),subscribeTopic:(i,s)=>this._reactor.subscribeTopic(n,i,s),subscribePresence:(i,s)=>this._reactor.subscribePresence(e,n,i,s),publishTopic:(i,s)=>this._reactor.publishTopic({roomType:e,roomId:n,topic:i,data:s}),publishPresence:i=>this._reactor.publishPresence(e,n,i),getPresence:i=>this._reactor.getPresence(e,n,i)}}shutdown(){delete zt[this._reactor.config.appId],this._reactor.shutdown()}queryOnce(e){return this._reactor.queryOnce(e)}}function Xs(t,e,n,r){const i=zt[t.appId];if(i)return i;const s=new Ts(Object.assign(Object.assign(Object.assign({},Js),t),{cardinalityInference:!!t.schema}),e||Nn,n||Fn,Object.assign(Object.assign({},r||{}),{"@instantdb/core":Qn})),o=new Gs(s);return zt[t.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in t?t.devtool:Bs)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&Fs(t.appId),o}const Zs={isLoading:!0,data:void 0,pageInfo:void 0,error:void 0};function eo(t){return{isLoading:!t,data:void 0,pageInfo:void 0,error:void 0,...t||{}}}function to(t,e){const n=e?Hs(e):null,r=Y(n),i=x.useRef(eo(t._reactor.getPreviousResult(n))),s=x.useCallback(a=>n?t.subscribeQuery(n,c=>{i.current={isLoading:!c,data:void 0,pageInfo:void 0,error:void 0,...c},a()}):()=>{},[r]);return{state:x.useSyncExternalStore(s,()=>i.current,()=>Zs),query:n}}function no(){const t=x.useRef(null);x.useEffect(()=>{n()},[]);function e(r,i){clearTimeout(t.current),t.current=setTimeout(i,r)}function n(){clearTimeout(t.current)}return{set:e,clear:n}}const ro=1e3;class io{constructor(e,n,r){this.useTopicEffect=(i,s)=>{x.useEffect(()=>this._core._reactor.subscribeTopic(this.id,i,(a,u)=>{s(a,u)}),[this.id,i])},this.usePublishTopic=i=>(x.useEffect(()=>this._core._reactor.joinRoom(this.id),[this.id]),x.useCallback(o=>{this._core._reactor.publishTopic({roomType:this.type,roomId:this.id,topic:i,data:o})},[this.id,i])),this.usePresence=(i={})=>{var a,u;const[s,o]=x.useState(()=>this._core._reactor.getPresence(this.type,this.id,i)??{peers:{},isLoading:!0});return x.useEffect(()=>this._core._reactor.subscribePresence(this.type,this.id,i,l=>{o(l)}),[this.id,i.user,(a=i.peers)==null?void 0:a.join(),(u=i.keys)==null?void 0:u.join()]),{...s,publishPresence:c=>{this._core._reactor.publishPresence(this.type,this.id,c)}}},this.useSyncPresence=(i,s)=>{x.useEffect(()=>this._core._reactor.joinRoom(this.id),[this.id]),x.useEffect(()=>this._core._reactor.publishPresence(this.type,this.id,i),[this.type,this.id,s??JSON.stringify(i)])},this.useTypingIndicator=(i,s={})=>{const o=no(),a=this.usePresence({keys:[i]}),u=x.useMemo(()=>{const l=this._core._reactor.getPresence(this.type,this.id);return s!=null&&s.writeOnly?[]:Object.values((l==null?void 0:l.peers)??{}).filter(f=>f[i]===!0)},[s==null?void 0:s.writeOnly,a]),c=l=>{this._core._reactor.publishPresence(this.type,this.id,{[i]:l}),l&&((s==null?void 0:s.timeout)===null||(s==null?void 0:s.timeout)===0||o.set((s==null?void 0:s.timeout)??ro,()=>{this._core._reactor.publishPresence(this.type,this.id,{[i]:null})}))};return{active:u,setActive:l=>{c(l)},inputProps:{onKeyDown:l=>{const h=!((s==null?void 0:s.stopOnEnter)&&l.key==="Enter");c(h)},onBlur:()=>{c(!1)}}}},this._core=e,this.type=n,this.id=r}}const so={isLoading:!0,user:void 0,error:void 0};class Gn{constructor(e,n){this.tx=It(),this.getLocalId=r=>this._core.getLocalId(r),this.transact=r=>this._core.transact(r),this.useQuery=r=>to(this._core,r).state,this.useAuth=()=>{const r=x.useRef(this._core._reactor._currentUserCached),i=x.useCallback(o=>this._core.subscribeAuth(u=>{r.current={isLoading:!1,...u},o()}),[]);return x.useSyncExternalStore(i,()=>r.current,()=>so)},this.useConnectionStatus=()=>{const r=x.useRef(this._core._reactor.status),i=x.useCallback(o=>this._core.subscribeConnectionStatus(u=>{u!==r.current&&(r.current=u,o())}),[]);return x.useSyncExternalStore(i,()=>r.current,()=>"connecting")},this.queryOnce=r=>this._core.queryOnce(r),this._core=Xs(e,this.constructor.Storage,this.constructor.NetworkListener,n),this.auth=this._core.auth,this.storage=this._core.storage}room(e="_defaultRoomType",n="_defaultRoomId"){return new io(this._core,e,n)}}class Xn extends Gn{}const oo="v0.17.3";function Zn(t){return new Xn(t,{"@instantdb/react":oo})}const ao=Zn;var Wt={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var er;function uo(){if(er)return ke;er=1;var t=x,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,u,c){var l,f={},h=null,v=null;c!==void 0&&(h=""+c),u.key!==void 0&&(h=""+u.key),u.ref!==void 0&&(v=u.ref);for(l in u)r.call(u,l)&&!s.hasOwnProperty(l)&&(f[l]=u[l]);if(a&&a.defaultProps)for(l in u=a.defaultProps,u)f[l]===void 0&&(f[l]=u[l]);return{$$typeof:e,type:a,key:h,ref:v,props:f,_owner:i.current}}return ke.Fragment=n,ke.jsx=o,ke.jsxs=o,ke}var Ie={},tr;function co(){if(tr)return Ie;tr=1;var t={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return t.NODE_ENV!=="production"&&function(){var e=x,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.for("react.offscreen"),m=Symbol.iterator,E="@@iterator";function S(d){if(d===null||typeof d!="object")return null;var p=m&&d[m]||d[E];return typeof p=="function"?p:null}var y=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function g(d){{for(var p=arguments.length,_=new Array(p>1?p-1:0),w=1;w<p;w++)_[w-1]=arguments[w];k("error",d,_)}}function k(d,p,_){{var w=y.ReactDebugCurrentFrame,P=w.getStackAddendum();P!==""&&(p+="%s",_=_.concat([P]));var A=_.map(function(C){return String(C)});A.unshift("Warning: "+p),Function.prototype.apply.call(console[d],console,A)}}var O=!1,U=!1,Q=!1,ce=!1,De=!1,rt;rt=Symbol.for("react.module.reference");function ve(d){return!!(typeof d=="string"||typeof d=="function"||d===i||d===o||De||d===s||d===l||d===f||ce||d===b||O||U||Q||typeof d=="object"&&d!==null&&(d.$$typeof===v||d.$$typeof===h||d.$$typeof===a||d.$$typeof===u||d.$$typeof===c||d.$$typeof===rt||d.getModuleId!==void 0))}function it(d,p,_){var w=d.displayName;if(w)return w;var P=p.displayName||p.name||"";return P!==""?_+"("+P+")":_}function Ue(d){return d.displayName||"Context"}function Z(d){if(d==null)return null;if(typeof d.tag=="number"&&g("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case i:return"Fragment";case r:return"Portal";case o:return"Profiler";case s:return"StrictMode";case l:return"Suspense";case f:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case u:var p=d;return Ue(p)+".Consumer";case a:var _=d;return Ue(_._context)+".Provider";case c:return it(d,d.render,"ForwardRef");case h:var w=d.displayName||null;return w!==null?w:Z(d.type)||"Memo";case v:{var P=d,A=P._payload,C=P._init;try{return Z(C(A))}catch{return null}}}return null}var T=Object.assign,$=0,le,ne,re,Re,de,st,ot;function at(){}at.__reactDisabledLog=!0;function Vt(){{if($===0){le=console.log,ne=console.info,re=console.warn,Re=console.error,de=console.group,st=console.groupCollapsed,ot=console.groupEnd;var d={configurable:!0,enumerable:!0,value:at,writable:!0};Object.defineProperties(console,{info:d,log:d,warn:d,error:d,group:d,groupCollapsed:d,groupEnd:d})}$++}}function Bt(){{if($--,$===0){var d={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:T({},d,{value:le}),info:T({},d,{value:ne}),warn:T({},d,{value:re}),error:T({},d,{value:Re}),group:T({},d,{value:de}),groupCollapsed:T({},d,{value:st}),groupEnd:T({},d,{value:ot})})}$<0&&g("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Jt=y.ReactCurrentDispatcher,Qt;function ut(d,p,_){{if(Qt===void 0)try{throw Error()}catch(P){var w=P.stack.trim().match(/\n( *(at )?)/);Qt=w&&w[1]||""}return`
`+Qt+d}}var Kt=!1,ct;{var _o=typeof WeakMap=="function"?WeakMap:Map;ct=new _o}function rr(d,p){if(!d||Kt)return"";{var _=ct.get(d);if(_!==void 0)return _}var w;Kt=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var A;A=Jt.current,Jt.current=null,Vt();try{if(p){var C=function(){throw Error()};if(Object.defineProperty(C.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(C,[])}catch(K){w=K}Reflect.construct(d,[],C)}else{try{C.call()}catch(K){w=K}d.call(C.prototype)}}else{try{throw Error()}catch(K){w=K}d()}}catch(K){if(K&&w&&typeof K.stack=="string"){for(var j=K.stack.split(`
`),V=w.stack.split(`
`),I=j.length-1,D=V.length-1;I>=1&&D>=0&&j[I]!==V[D];)D--;for(;I>=1&&D>=0;I--,D--)if(j[I]!==V[D]){if(I!==1||D!==1)do if(I--,D--,D<0||j[I]!==V[D]){var ie=`
`+j[I].replace(" at new "," at ");return d.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",d.displayName)),typeof d=="function"&&ct.set(d,ie),ie}while(I>=1&&D>=0);break}}}finally{Kt=!1,Jt.current=A,Bt(),Error.prepareStackTrace=P}var Ce=d?d.displayName||d.name:"",me=Ce?ut(Ce):"";return typeof d=="function"&&ct.set(d,me),me}function yo(d,p,_){return rr(d,!1)}function bo(d){var p=d.prototype;return!!(p&&p.isReactComponent)}function lt(d,p,_){if(d==null)return"";if(typeof d=="function")return rr(d,bo(d));if(typeof d=="string")return ut(d);switch(d){case l:return ut("Suspense");case f:return ut("SuspenseList")}if(typeof d=="object")switch(d.$$typeof){case c:return yo(d.render);case h:return lt(d.type,p,_);case v:{var w=d,P=w._payload,A=w._init;try{return lt(A(P),p,_)}catch{}}}return""}var $e=Object.prototype.hasOwnProperty,ir={},sr=y.ReactDebugCurrentFrame;function dt(d){if(d){var p=d._owner,_=lt(d.type,d._source,p?p.type:null);sr.setExtraStackFrame(_)}else sr.setExtraStackFrame(null)}function go(d,p,_,w,P){{var A=Function.call.bind($e);for(var C in d)if(A(d,C)){var j=void 0;try{if(typeof d[C]!="function"){var V=Error((w||"React class")+": "+_+" type `"+C+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof d[C]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw V.name="Invariant Violation",V}j=d[C](p,C,w,_,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(I){j=I}j&&!(j instanceof Error)&&(dt(P),g("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",w||"React class",_,C,typeof j),dt(null)),j instanceof Error&&!(j.message in ir)&&(ir[j.message]=!0,dt(P),g("Failed %s type: %s",_,j.message),dt(null))}}}var wo=Array.isArray;function Yt(d){return wo(d)}function mo(d){{var p=typeof Symbol=="function"&&Symbol.toStringTag,_=p&&d[Symbol.toStringTag]||d.constructor.name||"Object";return _}}function Oo(d){try{return or(d),!1}catch{return!0}}function or(d){return""+d}function ar(d){if(Oo(d))return g("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",mo(d)),or(d)}var Le=y.ReactCurrentOwner,So={key:!0,ref:!0,__self:!0,__source:!0},ur,cr,Ht;Ht={};function Eo(d){if($e.call(d,"ref")){var p=Object.getOwnPropertyDescriptor(d,"ref").get;if(p&&p.isReactWarning)return!1}return d.ref!==void 0}function Ro(d){if($e.call(d,"key")){var p=Object.getOwnPropertyDescriptor(d,"key").get;if(p&&p.isReactWarning)return!1}return d.key!==void 0}function jo(d,p){if(typeof d.ref=="string"&&Le.current&&p&&Le.current.stateNode!==p){var _=Z(Le.current.type);Ht[_]||(g('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Z(Le.current.type),d.ref),Ht[_]=!0)}}function Co(d,p){{var _=function(){ur||(ur=!0,g("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",p))};_.isReactWarning=!0,Object.defineProperty(d,"key",{get:_,configurable:!0})}}function Po(d,p){{var _=function(){cr||(cr=!0,g("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",p))};_.isReactWarning=!0,Object.defineProperty(d,"ref",{get:_,configurable:!0})}}var To=function(d,p,_,w,P,A,C){var j={$$typeof:n,type:d,key:p,ref:_,props:C,_owner:A};return j._store={},Object.defineProperty(j._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(j,"_self",{configurable:!1,enumerable:!1,writable:!1,value:w}),Object.defineProperty(j,"_source",{configurable:!1,enumerable:!1,writable:!1,value:P}),Object.freeze&&(Object.freeze(j.props),Object.freeze(j)),j};function Ao(d,p,_,w,P){{var A,C={},j=null,V=null;_!==void 0&&(ar(_),j=""+_),Ro(p)&&(ar(p.key),j=""+p.key),Eo(p)&&(V=p.ref,jo(p,P));for(A in p)$e.call(p,A)&&!So.hasOwnProperty(A)&&(C[A]=p[A]);if(d&&d.defaultProps){var I=d.defaultProps;for(A in I)C[A]===void 0&&(C[A]=I[A])}if(j||V){var D=typeof d=="function"?d.displayName||d.name||"Unknown":d;j&&Co(C,D),V&&Po(C,D)}return To(d,j,V,P,w,Le.current,C)}}var Gt=y.ReactCurrentOwner,lr=y.ReactDebugCurrentFrame;function je(d){if(d){var p=d._owner,_=lt(d.type,d._source,p?p.type:null);lr.setExtraStackFrame(_)}else lr.setExtraStackFrame(null)}var Xt;Xt=!1;function Zt(d){return typeof d=="object"&&d!==null&&d.$$typeof===n}function dr(){{if(Gt.current){var d=Z(Gt.current.type);if(d)return`

Check the render method of \``+d+"`."}return""}}function xo(d){return""}var fr={};function Mo(d){{var p=dr();if(!p){var _=typeof d=="string"?d:d.displayName||d.name;_&&(p=`

Check the top-level render call using <`+_+">.")}return p}}function hr(d,p){{if(!d._store||d._store.validated||d.key!=null)return;d._store.validated=!0;var _=Mo(p);if(fr[_])return;fr[_]=!0;var w="";d&&d._owner&&d._owner!==Gt.current&&(w=" It was passed a child from "+Z(d._owner.type)+"."),je(d),g('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',_,w),je(null)}}function pr(d,p){{if(typeof d!="object")return;if(Yt(d))for(var _=0;_<d.length;_++){var w=d[_];Zt(w)&&hr(w,p)}else if(Zt(d))d._store&&(d._store.validated=!0);else if(d){var P=S(d);if(typeof P=="function"&&P!==d.entries)for(var A=P.call(d),C;!(C=A.next()).done;)Zt(C.value)&&hr(C.value,p)}}}function ko(d){{var p=d.type;if(p==null||typeof p=="string")return;var _;if(typeof p=="function")_=p.propTypes;else if(typeof p=="object"&&(p.$$typeof===c||p.$$typeof===h))_=p.propTypes;else return;if(_){var w=Z(p);go(_,d.props,"prop",w,d)}else if(p.PropTypes!==void 0&&!Xt){Xt=!0;var P=Z(p);g("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",P||"Unknown")}typeof p.getDefaultProps=="function"&&!p.getDefaultProps.isReactClassApproved&&g("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Io(d){{for(var p=Object.keys(d.props),_=0;_<p.length;_++){var w=p[_];if(w!=="children"&&w!=="key"){je(d),g("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",w),je(null);break}}d.ref!==null&&(je(d),g("Invalid attribute `ref` supplied to `React.Fragment`."),je(null))}}var vr={};function _r(d,p,_,w,P,A){{var C=ve(d);if(!C){var j="";(d===void 0||typeof d=="object"&&d!==null&&Object.keys(d).length===0)&&(j+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var V=xo();V?j+=V:j+=dr();var I;d===null?I="null":Yt(d)?I="array":d!==void 0&&d.$$typeof===n?(I="<"+(Z(d.type)||"Unknown")+" />",j=" Did you accidentally export a JSX literal instead of a component?"):I=typeof d,g("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",I,j)}var D=Ao(d,p,_,P,A);if(D==null)return D;if(C){var ie=p.children;if(ie!==void 0)if(w)if(Yt(ie)){for(var Ce=0;Ce<ie.length;Ce++)pr(ie[Ce],d);Object.freeze&&Object.freeze(ie)}else g("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else pr(ie,d)}if($e.call(p,"key")){var me=Z(d),K=Object.keys(p).filter(function(Fo){return Fo!=="key"}),en=K.length>0?"{key: someKey, "+K.join(": ..., ")+": ...}":"{key: someKey}";if(!vr[me+en]){var No=K.length>0?"{"+K.join(": ..., ")+": ...}":"{}";g(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,en,me,No,me),vr[me+en]=!0}}return d===i?Io(D):ko(D),D}}function Do(d,p,_){return _r(d,p,_,!0)}function Uo(d,p,_){return _r(d,p,_,!1)}var $o=Uo,Lo=Do;Ie.Fragment=i,Ie.jsx=$o,Ie.jsxs=Lo}(),Ie}var lo={};lo.NODE_ENV==="production"?Wt.exports=uo():Wt.exports=co();var X=Wt.exports;function fo({as:t="div",spaceId:e,room:n,className:r,style:i,userCursorColor:s,children:o,renderCursor:a,propagate:u,zIndex:c}){const l=e||`cursors-space-default--${String(n.type)}-${n.id}`,f=n.usePresence({keys:[l]}),h=n._core._reactor.getPresence(n.type,n.id);function v(y,g){const k=g.clientX,O=g.clientY,U=(k-y.left)/y.width*100,Q=(O-y.top)/y.height*100;f.publishPresence({[l]:{x:k,y:O,xPercent:U,yPercent:Q,color:s}})}function b(y){u||y.stopPropagation();const g=y.currentTarget.getBoundingClientRect();v(g,y)}function m(y){f.publishPresence({[l]:void 0})}function E(y){if(y.touches.length!==1)return;const g=y.touches[0];if(g.target instanceof Element){u||y.stopPropagation();const k=g.target.getBoundingClientRect();v(k,g)}}function S(y){f.publishPresence({[l]:void 0})}return x.createElement(t,{onMouseMove:b,onMouseOut:m,onTouchMove:E,onTouchEnd:S,className:r,style:{position:"relative",...i}},[o,X.jsx("div",{style:{...nr,...po,zIndex:c!==void 0?c:vo},children:Object.entries(f.peers).map(([y,g])=>{const k=g[l];return k?X.jsx("div",{style:{...nr,transform:`translate(${k.xPercent}%, ${k.yPercent}%)`,transformOrigin:"0 0",transition:"transform 100ms"},children:a?a({color:k.color,presence:h.peers[y]}):X.jsx(ho,{...k})},y):null})},l)])}function ho({color:t}){const n=t||"black";return X.jsxs("svg",{style:{height:35,width:35},viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[X.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[X.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),X.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),X.jsxs("g",{fill:"white",transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[X.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),X.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),X.jsxs("g",{fill:n,transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[X.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),X.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}const nr={position:"absolute",top:0,left:0,bottom:0,right:0},po={overflow:"hidden",pointerEvents:"none",userSelect:"none"},vo=99999;q.Cursors=fo,q.InstantReactAbstractDatabase=Gn,q.InstantReactWebDatabase=Xn,q.i=Ns,q.id=N,q.init=Zn,q.init_experimental=ao,q.lookup=Di,q.tx=$i,Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});
